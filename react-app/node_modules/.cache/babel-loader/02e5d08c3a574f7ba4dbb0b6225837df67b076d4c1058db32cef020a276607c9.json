{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport * as dom from '../../../base/browser/dom.js';\nimport { StandardWheelEvent } from '../../../base/browser/mouseEvent.js';\nimport { TimeoutTimer } from '../../../base/common/async.js';\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport * as platform from '../../../base/common/platform.js';\nimport { HitTestContext, MouseTarget, MouseTargetFactory } from './mouseTarget.js';\nimport { ClientCoordinates, EditorMouseEvent, EditorMouseEventFactory, GlobalEditorPointerMoveMonitor, createEditorPagePosition, createCoordinatesRelativeToEditor } from '../editorDom.js';\nimport { EditorZoom } from '../../common/config/editorZoom.js';\nimport { Position } from '../../common/core/position.js';\nimport { Selection } from '../../common/core/selection.js';\nimport { ViewEventHandler } from '../../common/viewEventHandler.js';\nexport class MouseHandler extends ViewEventHandler {\n  constructor(context, viewController, viewHelper) {\n    super();\n    this._mouseLeaveMonitor = null;\n    this._context = context;\n    this.viewController = viewController;\n    this.viewHelper = viewHelper;\n    this.mouseTargetFactory = new MouseTargetFactory(this._context, viewHelper);\n    this._mouseDownOperation = this._register(new MouseDownOperation(this._context, this.viewController, this.viewHelper, (e, testEventTarget) => this._createMouseTarget(e, testEventTarget), e => this._getMouseColumn(e)));\n    this.lastMouseLeaveTime = -1;\n    this._height = this._context.configuration.options.get(133 /* EditorOption.layoutInfo */).height;\n    const mouseEvents = new EditorMouseEventFactory(this.viewHelper.viewDomNode);\n    this._register(mouseEvents.onContextMenu(this.viewHelper.viewDomNode, e => this._onContextMenu(e, true)));\n    this._register(mouseEvents.onMouseMove(this.viewHelper.viewDomNode, e => {\n      this._onMouseMove(e);\n      // See https://github.com/microsoft/vscode/issues/138789\n      // When moving the mouse really quickly, the browser sometimes forgets to\n      // send us a `mouseleave` or `mouseout` event. We therefore install here\n      // a global `mousemove` listener to manually recover if the mouse goes outside\n      // the editor. As soon as the mouse leaves outside of the editor, we\n      // remove this listener\n      if (!this._mouseLeaveMonitor) {\n        this._mouseLeaveMonitor = dom.addDisposableListener(document, 'mousemove', e => {\n          if (!this.viewHelper.viewDomNode.contains(e.target)) {\n            // went outside the editor!\n            this._onMouseLeave(new EditorMouseEvent(e, false, this.viewHelper.viewDomNode));\n          }\n        });\n      }\n    }));\n    this._register(mouseEvents.onMouseUp(this.viewHelper.viewDomNode, e => this._onMouseUp(e)));\n    this._register(mouseEvents.onMouseLeave(this.viewHelper.viewDomNode, e => this._onMouseLeave(e)));\n    // `pointerdown` events can't be used to determine if there's a double click, or triple click\n    // because their `e.detail` is always 0.\n    // We will therefore save the pointer id for the mouse and then reuse it in the `mousedown` event\n    // for `element.setPointerCapture`.\n    let capturePointerId = 0;\n    this._register(mouseEvents.onPointerDown(this.viewHelper.viewDomNode, (e, pointerId) => {\n      capturePointerId = pointerId;\n    }));\n    // The `pointerup` listener registered by `GlobalEditorPointerMoveMonitor` does not get invoked 100% of the times.\n    // I speculate that this is because the `pointerup` listener is only registered during the `mousedown` event, and perhaps\n    // the `pointerup` event is already queued for dispatching, which makes it that the new listener doesn't get fired.\n    // See https://github.com/microsoft/vscode/issues/146486 for repro steps.\n    // To compensate for that, we simply register here a `pointerup` listener and just communicate it.\n    this._register(dom.addDisposableListener(this.viewHelper.viewDomNode, dom.EventType.POINTER_UP, e => {\n      this._mouseDownOperation.onPointerUp();\n    }));\n    this._register(mouseEvents.onMouseDown(this.viewHelper.viewDomNode, e => this._onMouseDown(e, capturePointerId)));\n    const onMouseWheel = browserEvent => {\n      this.viewController.emitMouseWheel(browserEvent);\n      if (!this._context.configuration.options.get(70 /* EditorOption.mouseWheelZoom */)) {\n        return;\n      }\n      const e = new StandardWheelEvent(browserEvent);\n      const doMouseWheelZoom = platform.isMacintosh\n      // on macOS we support cmd + two fingers scroll (`metaKey` set)\n      // and also the two fingers pinch gesture (`ctrKey` set)\n      ? (browserEvent.metaKey || browserEvent.ctrlKey) && !browserEvent.shiftKey && !browserEvent.altKey : browserEvent.ctrlKey && !browserEvent.metaKey && !browserEvent.shiftKey && !browserEvent.altKey;\n      if (doMouseWheelZoom) {\n        const zoomLevel = EditorZoom.getZoomLevel();\n        const delta = e.deltaY > 0 ? 1 : -1;\n        EditorZoom.setZoomLevel(zoomLevel + delta);\n        e.preventDefault();\n        e.stopPropagation();\n      }\n    };\n    this._register(dom.addDisposableListener(this.viewHelper.viewDomNode, dom.EventType.MOUSE_WHEEL, onMouseWheel, {\n      capture: true,\n      passive: false\n    }));\n    this._context.addEventHandler(this);\n  }\n  dispose() {\n    this._context.removeEventHandler(this);\n    if (this._mouseLeaveMonitor) {\n      this._mouseLeaveMonitor.dispose();\n      this._mouseLeaveMonitor = null;\n    }\n    super.dispose();\n  }\n  // --- begin event handlers\n  onConfigurationChanged(e) {\n    if (e.hasChanged(133 /* EditorOption.layoutInfo */)) {\n      // layout change\n      const height = this._context.configuration.options.get(133 /* EditorOption.layoutInfo */).height;\n      if (this._height !== height) {\n        this._height = height;\n        this._mouseDownOperation.onHeightChanged();\n      }\n    }\n    return false;\n  }\n  onCursorStateChanged(e) {\n    this._mouseDownOperation.onCursorStateChanged(e);\n    return false;\n  }\n  onFocusChanged(e) {\n    return false;\n  }\n  onScrollChanged(e) {\n    this._mouseDownOperation.onScrollChanged();\n    return false;\n  }\n  // --- end event handlers\n  getTargetAtClientPoint(clientX, clientY) {\n    const clientPos = new ClientCoordinates(clientX, clientY);\n    const pos = clientPos.toPageCoordinates();\n    const editorPos = createEditorPagePosition(this.viewHelper.viewDomNode);\n    if (pos.y < editorPos.y || pos.y > editorPos.y + editorPos.height || pos.x < editorPos.x || pos.x > editorPos.x + editorPos.width) {\n      return null;\n    }\n    const relativePos = createCoordinatesRelativeToEditor(this.viewHelper.viewDomNode, editorPos, pos);\n    return this.mouseTargetFactory.createMouseTarget(this.viewHelper.getLastRenderData(), editorPos, pos, relativePos, null);\n  }\n  _createMouseTarget(e, testEventTarget) {\n    let target = e.target;\n    if (!this.viewHelper.viewDomNode.contains(target)) {\n      const shadowRoot = dom.getShadowRoot(this.viewHelper.viewDomNode);\n      if (shadowRoot) {\n        target = shadowRoot.elementsFromPoint(e.posx, e.posy).find(el => this.viewHelper.viewDomNode.contains(el));\n      }\n    }\n    return this.mouseTargetFactory.createMouseTarget(this.viewHelper.getLastRenderData(), e.editorPos, e.pos, e.relativePos, testEventTarget ? target : null);\n  }\n  _getMouseColumn(e) {\n    return this.mouseTargetFactory.getMouseColumn(e.relativePos);\n  }\n  _onContextMenu(e, testEventTarget) {\n    this.viewController.emitContextMenu({\n      event: e,\n      target: this._createMouseTarget(e, testEventTarget)\n    });\n  }\n  _onMouseMove(e) {\n    const targetIsWidget = this.mouseTargetFactory.mouseTargetIsWidget(e);\n    if (!targetIsWidget) {\n      e.preventDefault();\n    }\n    if (this._mouseDownOperation.isActive()) {\n      // In selection/drag operation\n      return;\n    }\n    const actualMouseMoveTime = e.timestamp;\n    if (actualMouseMoveTime < this.lastMouseLeaveTime) {\n      // Due to throttling, this event occurred before the mouse left the editor, therefore ignore it.\n      return;\n    }\n    this.viewController.emitMouseMove({\n      event: e,\n      target: this._createMouseTarget(e, true)\n    });\n  }\n  _onMouseLeave(e) {\n    if (this._mouseLeaveMonitor) {\n      this._mouseLeaveMonitor.dispose();\n      this._mouseLeaveMonitor = null;\n    }\n    this.lastMouseLeaveTime = new Date().getTime();\n    this.viewController.emitMouseLeave({\n      event: e,\n      target: null\n    });\n  }\n  _onMouseUp(e) {\n    this.viewController.emitMouseUp({\n      event: e,\n      target: this._createMouseTarget(e, true)\n    });\n  }\n  _onMouseDown(e, pointerId) {\n    const t = this._createMouseTarget(e, true);\n    const targetIsContent = t.type === 6 /* MouseTargetType.CONTENT_TEXT */ || t.type === 7 /* MouseTargetType.CONTENT_EMPTY */;\n    const targetIsGutter = t.type === 2 /* MouseTargetType.GUTTER_GLYPH_MARGIN */ || t.type === 3 /* MouseTargetType.GUTTER_LINE_NUMBERS */ || t.type === 4 /* MouseTargetType.GUTTER_LINE_DECORATIONS */;\n    const targetIsLineNumbers = t.type === 3 /* MouseTargetType.GUTTER_LINE_NUMBERS */;\n    const selectOnLineNumbers = this._context.configuration.options.get(100 /* EditorOption.selectOnLineNumbers */);\n    const targetIsViewZone = t.type === 8 /* MouseTargetType.CONTENT_VIEW_ZONE */ || t.type === 5 /* MouseTargetType.GUTTER_VIEW_ZONE */;\n    const targetIsWidget = t.type === 9 /* MouseTargetType.CONTENT_WIDGET */;\n    let shouldHandle = e.leftButton || e.middleButton;\n    if (platform.isMacintosh && e.leftButton && e.ctrlKey) {\n      shouldHandle = false;\n    }\n    const focus = () => {\n      e.preventDefault();\n      this.viewHelper.focusTextArea();\n    };\n    if (shouldHandle && (targetIsContent || targetIsLineNumbers && selectOnLineNumbers)) {\n      focus();\n      this._mouseDownOperation.start(t.type, e, pointerId);\n    } else if (targetIsGutter) {\n      // Do not steal focus\n      e.preventDefault();\n    } else if (targetIsViewZone) {\n      const viewZoneData = t.detail;\n      if (shouldHandle && this.viewHelper.shouldSuppressMouseDownOnViewZone(viewZoneData.viewZoneId)) {\n        focus();\n        this._mouseDownOperation.start(t.type, e, pointerId);\n        e.preventDefault();\n      }\n    } else if (targetIsWidget && this.viewHelper.shouldSuppressMouseDownOnWidget(t.detail)) {\n      focus();\n      e.preventDefault();\n    }\n    this.viewController.emitMouseDown({\n      event: e,\n      target: t\n    });\n  }\n}\nclass MouseDownOperation extends Disposable {\n  constructor(context, viewController, viewHelper, createMouseTarget, getMouseColumn) {\n    super();\n    this._context = context;\n    this._viewController = viewController;\n    this._viewHelper = viewHelper;\n    this._createMouseTarget = createMouseTarget;\n    this._getMouseColumn = getMouseColumn;\n    this._mouseMoveMonitor = this._register(new GlobalEditorPointerMoveMonitor(this._viewHelper.viewDomNode));\n    this._onScrollTimeout = this._register(new TimeoutTimer());\n    this._mouseState = new MouseDownState();\n    this._currentSelection = new Selection(1, 1, 1, 1);\n    this._isActive = false;\n    this._lastMouseEvent = null;\n  }\n  dispose() {\n    super.dispose();\n  }\n  isActive() {\n    return this._isActive;\n  }\n  _onMouseDownThenMove(e) {\n    this._lastMouseEvent = e;\n    this._mouseState.setModifiers(e);\n    const position = this._findMousePosition(e, false);\n    if (!position) {\n      // Ignoring because position is unknown\n      return;\n    }\n    if (this._mouseState.isDragAndDrop) {\n      this._viewController.emitMouseDrag({\n        event: e,\n        target: position\n      });\n    } else {\n      this._dispatchMouse(position, true);\n    }\n  }\n  start(targetType, e, pointerId) {\n    this._lastMouseEvent = e;\n    this._mouseState.setStartedOnLineNumbers(targetType === 3 /* MouseTargetType.GUTTER_LINE_NUMBERS */);\n    this._mouseState.setStartButtons(e);\n    this._mouseState.setModifiers(e);\n    const position = this._findMousePosition(e, true);\n    if (!position || !position.position) {\n      // Ignoring because position is unknown\n      return;\n    }\n    this._mouseState.trySetCount(e.detail, position.position);\n    // Overwrite the detail of the MouseEvent, as it will be sent out in an event and contributions might rely on it.\n    e.detail = this._mouseState.count;\n    const options = this._context.configuration.options;\n    if (!options.get(83 /* EditorOption.readOnly */) && options.get(31 /* EditorOption.dragAndDrop */) && !options.get(18 /* EditorOption.columnSelection */) && !this._mouseState.altKey // we don't support multiple mouse\n    && e.detail < 2 // only single click on a selection can work\n    && !this._isActive // the mouse is not down yet\n    && !this._currentSelection.isEmpty() // we don't drag single cursor\n    && position.type === 6 /* MouseTargetType.CONTENT_TEXT */ // single click on text\n    && position.position && this._currentSelection.containsPosition(position.position) // single click on a selection\n    ) {\n      this._mouseState.isDragAndDrop = true;\n      this._isActive = true;\n      this._mouseMoveMonitor.startMonitoring(this._viewHelper.viewLinesDomNode, pointerId, e.buttons, e => this._onMouseDownThenMove(e), browserEvent => {\n        const position = this._findMousePosition(this._lastMouseEvent, false);\n        if (browserEvent && browserEvent instanceof KeyboardEvent) {\n          // cancel\n          this._viewController.emitMouseDropCanceled();\n        } else {\n          this._viewController.emitMouseDrop({\n            event: this._lastMouseEvent,\n            target: position ? this._createMouseTarget(this._lastMouseEvent, true) : null // Ignoring because position is unknown, e.g., Content View Zone\n          });\n        }\n\n        this._stop();\n      });\n      return;\n    }\n    this._mouseState.isDragAndDrop = false;\n    this._dispatchMouse(position, e.shiftKey);\n    if (!this._isActive) {\n      this._isActive = true;\n      this._mouseMoveMonitor.startMonitoring(this._viewHelper.viewLinesDomNode, pointerId, e.buttons, e => this._onMouseDownThenMove(e), () => this._stop());\n    }\n  }\n  _stop() {\n    this._isActive = false;\n    this._onScrollTimeout.cancel();\n  }\n  onHeightChanged() {\n    this._mouseMoveMonitor.stopMonitoring();\n  }\n  onPointerUp() {\n    this._mouseMoveMonitor.stopMonitoring();\n  }\n  onScrollChanged() {\n    if (!this._isActive) {\n      return;\n    }\n    this._onScrollTimeout.setIfNotSet(() => {\n      if (!this._lastMouseEvent) {\n        return;\n      }\n      const position = this._findMousePosition(this._lastMouseEvent, false);\n      if (!position) {\n        // Ignoring because position is unknown\n        return;\n      }\n      if (this._mouseState.isDragAndDrop) {\n        // Ignoring because users are dragging the text\n        return;\n      }\n      this._dispatchMouse(position, true);\n    }, 10);\n  }\n  onCursorStateChanged(e) {\n    this._currentSelection = e.selections[0];\n  }\n  _getPositionOutsideEditor(e) {\n    const editorContent = e.editorPos;\n    const model = this._context.viewModel;\n    const viewLayout = this._context.viewLayout;\n    const mouseColumn = this._getMouseColumn(e);\n    if (e.posy < editorContent.y) {\n      const verticalOffset = Math.max(viewLayout.getCurrentScrollTop() - (editorContent.y - e.posy), 0);\n      const viewZoneData = HitTestContext.getZoneAtCoord(this._context, verticalOffset);\n      if (viewZoneData) {\n        const newPosition = this._helpPositionJumpOverViewZone(viewZoneData);\n        if (newPosition) {\n          return MouseTarget.createOutsideEditor(mouseColumn, newPosition);\n        }\n      }\n      const aboveLineNumber = viewLayout.getLineNumberAtVerticalOffset(verticalOffset);\n      return MouseTarget.createOutsideEditor(mouseColumn, new Position(aboveLineNumber, 1));\n    }\n    if (e.posy > editorContent.y + editorContent.height) {\n      const verticalOffset = viewLayout.getCurrentScrollTop() + e.relativePos.y;\n      const viewZoneData = HitTestContext.getZoneAtCoord(this._context, verticalOffset);\n      if (viewZoneData) {\n        const newPosition = this._helpPositionJumpOverViewZone(viewZoneData);\n        if (newPosition) {\n          return MouseTarget.createOutsideEditor(mouseColumn, newPosition);\n        }\n      }\n      const belowLineNumber = viewLayout.getLineNumberAtVerticalOffset(verticalOffset);\n      return MouseTarget.createOutsideEditor(mouseColumn, new Position(belowLineNumber, model.getLineMaxColumn(belowLineNumber)));\n    }\n    const possibleLineNumber = viewLayout.getLineNumberAtVerticalOffset(viewLayout.getCurrentScrollTop() + e.relativePos.y);\n    if (e.posx < editorContent.x) {\n      return MouseTarget.createOutsideEditor(mouseColumn, new Position(possibleLineNumber, 1));\n    }\n    if (e.posx > editorContent.x + editorContent.width) {\n      return MouseTarget.createOutsideEditor(mouseColumn, new Position(possibleLineNumber, model.getLineMaxColumn(possibleLineNumber)));\n    }\n    return null;\n  }\n  _findMousePosition(e, testEventTarget) {\n    const positionOutsideEditor = this._getPositionOutsideEditor(e);\n    if (positionOutsideEditor) {\n      return positionOutsideEditor;\n    }\n    const t = this._createMouseTarget(e, testEventTarget);\n    const hintedPosition = t.position;\n    if (!hintedPosition) {\n      return null;\n    }\n    if (t.type === 8 /* MouseTargetType.CONTENT_VIEW_ZONE */ || t.type === 5 /* MouseTargetType.GUTTER_VIEW_ZONE */) {\n      const newPosition = this._helpPositionJumpOverViewZone(t.detail);\n      if (newPosition) {\n        return MouseTarget.createViewZone(t.type, t.element, t.mouseColumn, newPosition, t.detail);\n      }\n    }\n    return t;\n  }\n  _helpPositionJumpOverViewZone(viewZoneData) {\n    // Force position on view zones to go above or below depending on where selection started from\n    const selectionStart = new Position(this._currentSelection.selectionStartLineNumber, this._currentSelection.selectionStartColumn);\n    const positionBefore = viewZoneData.positionBefore;\n    const positionAfter = viewZoneData.positionAfter;\n    if (positionBefore && positionAfter) {\n      if (positionBefore.isBefore(selectionStart)) {\n        return positionBefore;\n      } else {\n        return positionAfter;\n      }\n    }\n    return null;\n  }\n  _dispatchMouse(position, inSelectionMode) {\n    if (!position.position) {\n      return;\n    }\n    this._viewController.dispatchMouse({\n      position: position.position,\n      mouseColumn: position.mouseColumn,\n      startedOnLineNumbers: this._mouseState.startedOnLineNumbers,\n      inSelectionMode: inSelectionMode,\n      mouseDownCount: this._mouseState.count,\n      altKey: this._mouseState.altKey,\n      ctrlKey: this._mouseState.ctrlKey,\n      metaKey: this._mouseState.metaKey,\n      shiftKey: this._mouseState.shiftKey,\n      leftButton: this._mouseState.leftButton,\n      middleButton: this._mouseState.middleButton,\n      onInjectedText: position.type === 6 /* MouseTargetType.CONTENT_TEXT */ && position.detail.injectedText !== null\n    });\n  }\n}\nclass MouseDownState {\n  constructor() {\n    this._altKey = false;\n    this._ctrlKey = false;\n    this._metaKey = false;\n    this._shiftKey = false;\n    this._leftButton = false;\n    this._middleButton = false;\n    this._startedOnLineNumbers = false;\n    this._lastMouseDownPosition = null;\n    this._lastMouseDownPositionEqualCount = 0;\n    this._lastMouseDownCount = 0;\n    this._lastSetMouseDownCountTime = 0;\n    this.isDragAndDrop = false;\n  }\n  get altKey() {\n    return this._altKey;\n  }\n  get ctrlKey() {\n    return this._ctrlKey;\n  }\n  get metaKey() {\n    return this._metaKey;\n  }\n  get shiftKey() {\n    return this._shiftKey;\n  }\n  get leftButton() {\n    return this._leftButton;\n  }\n  get middleButton() {\n    return this._middleButton;\n  }\n  get startedOnLineNumbers() {\n    return this._startedOnLineNumbers;\n  }\n  get count() {\n    return this._lastMouseDownCount;\n  }\n  setModifiers(source) {\n    this._altKey = source.altKey;\n    this._ctrlKey = source.ctrlKey;\n    this._metaKey = source.metaKey;\n    this._shiftKey = source.shiftKey;\n  }\n  setStartButtons(source) {\n    this._leftButton = source.leftButton;\n    this._middleButton = source.middleButton;\n  }\n  setStartedOnLineNumbers(startedOnLineNumbers) {\n    this._startedOnLineNumbers = startedOnLineNumbers;\n  }\n  trySetCount(setMouseDownCount, newMouseDownPosition) {\n    // a. Invalidate multiple clicking if too much time has passed (will be hit by IE because the detail field of mouse events contains garbage in IE10)\n    const currentTime = new Date().getTime();\n    if (currentTime - this._lastSetMouseDownCountTime > MouseDownState.CLEAR_MOUSE_DOWN_COUNT_TIME) {\n      setMouseDownCount = 1;\n    }\n    this._lastSetMouseDownCountTime = currentTime;\n    // b. Ensure that we don't jump from single click to triple click in one go (will be hit by IE because the detail field of mouse events contains garbage in IE10)\n    if (setMouseDownCount > this._lastMouseDownCount + 1) {\n      setMouseDownCount = this._lastMouseDownCount + 1;\n    }\n    // c. Invalidate multiple clicking if the logical position is different\n    if (this._lastMouseDownPosition && this._lastMouseDownPosition.equals(newMouseDownPosition)) {\n      this._lastMouseDownPositionEqualCount++;\n    } else {\n      this._lastMouseDownPositionEqualCount = 1;\n    }\n    this._lastMouseDownPosition = newMouseDownPosition;\n    // Finally set the lastMouseDownCount\n    this._lastMouseDownCount = Math.min(setMouseDownCount, this._lastMouseDownPositionEqualCount);\n  }\n}\nMouseDownState.CLEAR_MOUSE_DOWN_COUNT_TIME = 400; // ms","map":{"version":3,"names":["dom","StandardWheelEvent","TimeoutTimer","Disposable","platform","HitTestContext","MouseTarget","MouseTargetFactory","ClientCoordinates","EditorMouseEvent","EditorMouseEventFactory","GlobalEditorPointerMoveMonitor","createEditorPagePosition","createCoordinatesRelativeToEditor","EditorZoom","Position","Selection","ViewEventHandler","MouseHandler","constructor","context","viewController","viewHelper","_mouseLeaveMonitor","_context","mouseTargetFactory","_mouseDownOperation","_register","MouseDownOperation","e","testEventTarget","_createMouseTarget","_getMouseColumn","lastMouseLeaveTime","_height","configuration","options","get","height","mouseEvents","viewDomNode","onContextMenu","_onContextMenu","onMouseMove","_onMouseMove","addDisposableListener","document","contains","target","_onMouseLeave","onMouseUp","_onMouseUp","onMouseLeave","capturePointerId","onPointerDown","pointerId","EventType","POINTER_UP","onPointerUp","onMouseDown","_onMouseDown","onMouseWheel","browserEvent","emitMouseWheel","doMouseWheelZoom","isMacintosh","metaKey","ctrlKey","shiftKey","altKey","zoomLevel","getZoomLevel","delta","deltaY","setZoomLevel","preventDefault","stopPropagation","MOUSE_WHEEL","capture","passive","addEventHandler","dispose","removeEventHandler","onConfigurationChanged","hasChanged","onHeightChanged","onCursorStateChanged","onFocusChanged","onScrollChanged","getTargetAtClientPoint","clientX","clientY","clientPos","pos","toPageCoordinates","editorPos","y","x","width","relativePos","createMouseTarget","getLastRenderData","shadowRoot","getShadowRoot","elementsFromPoint","posx","posy","find","el","getMouseColumn","emitContextMenu","event","targetIsWidget","mouseTargetIsWidget","isActive","actualMouseMoveTime","timestamp","emitMouseMove","Date","getTime","emitMouseLeave","emitMouseUp","t","targetIsContent","type","targetIsGutter","targetIsLineNumbers","selectOnLineNumbers","targetIsViewZone","shouldHandle","leftButton","middleButton","focus","focusTextArea","start","viewZoneData","detail","shouldSuppressMouseDownOnViewZone","viewZoneId","shouldSuppressMouseDownOnWidget","emitMouseDown","_viewController","_viewHelper","_mouseMoveMonitor","_onScrollTimeout","_mouseState","MouseDownState","_currentSelection","_isActive","_lastMouseEvent","_onMouseDownThenMove","setModifiers","position","_findMousePosition","isDragAndDrop","emitMouseDrag","_dispatchMouse","targetType","setStartedOnLineNumbers","setStartButtons","trySetCount","count","isEmpty","containsPosition","startMonitoring","viewLinesDomNode","buttons","KeyboardEvent","emitMouseDropCanceled","emitMouseDrop","_stop","cancel","stopMonitoring","setIfNotSet","selections","_getPositionOutsideEditor","editorContent","model","viewModel","viewLayout","mouseColumn","verticalOffset","Math","max","getCurrentScrollTop","getZoneAtCoord","newPosition","_helpPositionJumpOverViewZone","createOutsideEditor","aboveLineNumber","getLineNumberAtVerticalOffset","belowLineNumber","getLineMaxColumn","possibleLineNumber","positionOutsideEditor","hintedPosition","createViewZone","element","selectionStart","selectionStartLineNumber","selectionStartColumn","positionBefore","positionAfter","isBefore","inSelectionMode","dispatchMouse","startedOnLineNumbers","mouseDownCount","onInjectedText","injectedText","_altKey","_ctrlKey","_metaKey","_shiftKey","_leftButton","_middleButton","_startedOnLineNumbers","_lastMouseDownPosition","_lastMouseDownPositionEqualCount","_lastMouseDownCount","_lastSetMouseDownCountTime","source","setMouseDownCount","newMouseDownPosition","currentTime","CLEAR_MOUSE_DOWN_COUNT_TIME","equals","min"],"sources":["/home/deathblade287/Desktop/AI-MODELS-TESTING/react-app/node_modules/monaco-editor/esm/vs/editor/browser/controller/mouseHandler.js"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport * as dom from '../../../base/browser/dom.js';\nimport { StandardWheelEvent } from '../../../base/browser/mouseEvent.js';\nimport { TimeoutTimer } from '../../../base/common/async.js';\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport * as platform from '../../../base/common/platform.js';\nimport { HitTestContext, MouseTarget, MouseTargetFactory } from './mouseTarget.js';\nimport { ClientCoordinates, EditorMouseEvent, EditorMouseEventFactory, GlobalEditorPointerMoveMonitor, createEditorPagePosition, createCoordinatesRelativeToEditor } from '../editorDom.js';\nimport { EditorZoom } from '../../common/config/editorZoom.js';\nimport { Position } from '../../common/core/position.js';\nimport { Selection } from '../../common/core/selection.js';\nimport { ViewEventHandler } from '../../common/viewEventHandler.js';\nexport class MouseHandler extends ViewEventHandler {\n    constructor(context, viewController, viewHelper) {\n        super();\n        this._mouseLeaveMonitor = null;\n        this._context = context;\n        this.viewController = viewController;\n        this.viewHelper = viewHelper;\n        this.mouseTargetFactory = new MouseTargetFactory(this._context, viewHelper);\n        this._mouseDownOperation = this._register(new MouseDownOperation(this._context, this.viewController, this.viewHelper, (e, testEventTarget) => this._createMouseTarget(e, testEventTarget), (e) => this._getMouseColumn(e)));\n        this.lastMouseLeaveTime = -1;\n        this._height = this._context.configuration.options.get(133 /* EditorOption.layoutInfo */).height;\n        const mouseEvents = new EditorMouseEventFactory(this.viewHelper.viewDomNode);\n        this._register(mouseEvents.onContextMenu(this.viewHelper.viewDomNode, (e) => this._onContextMenu(e, true)));\n        this._register(mouseEvents.onMouseMove(this.viewHelper.viewDomNode, (e) => {\n            this._onMouseMove(e);\n            // See https://github.com/microsoft/vscode/issues/138789\n            // When moving the mouse really quickly, the browser sometimes forgets to\n            // send us a `mouseleave` or `mouseout` event. We therefore install here\n            // a global `mousemove` listener to manually recover if the mouse goes outside\n            // the editor. As soon as the mouse leaves outside of the editor, we\n            // remove this listener\n            if (!this._mouseLeaveMonitor) {\n                this._mouseLeaveMonitor = dom.addDisposableListener(document, 'mousemove', (e) => {\n                    if (!this.viewHelper.viewDomNode.contains(e.target)) {\n                        // went outside the editor!\n                        this._onMouseLeave(new EditorMouseEvent(e, false, this.viewHelper.viewDomNode));\n                    }\n                });\n            }\n        }));\n        this._register(mouseEvents.onMouseUp(this.viewHelper.viewDomNode, (e) => this._onMouseUp(e)));\n        this._register(mouseEvents.onMouseLeave(this.viewHelper.viewDomNode, (e) => this._onMouseLeave(e)));\n        // `pointerdown` events can't be used to determine if there's a double click, or triple click\n        // because their `e.detail` is always 0.\n        // We will therefore save the pointer id for the mouse and then reuse it in the `mousedown` event\n        // for `element.setPointerCapture`.\n        let capturePointerId = 0;\n        this._register(mouseEvents.onPointerDown(this.viewHelper.viewDomNode, (e, pointerId) => {\n            capturePointerId = pointerId;\n        }));\n        // The `pointerup` listener registered by `GlobalEditorPointerMoveMonitor` does not get invoked 100% of the times.\n        // I speculate that this is because the `pointerup` listener is only registered during the `mousedown` event, and perhaps\n        // the `pointerup` event is already queued for dispatching, which makes it that the new listener doesn't get fired.\n        // See https://github.com/microsoft/vscode/issues/146486 for repro steps.\n        // To compensate for that, we simply register here a `pointerup` listener and just communicate it.\n        this._register(dom.addDisposableListener(this.viewHelper.viewDomNode, dom.EventType.POINTER_UP, (e) => {\n            this._mouseDownOperation.onPointerUp();\n        }));\n        this._register(mouseEvents.onMouseDown(this.viewHelper.viewDomNode, (e) => this._onMouseDown(e, capturePointerId)));\n        const onMouseWheel = (browserEvent) => {\n            this.viewController.emitMouseWheel(browserEvent);\n            if (!this._context.configuration.options.get(70 /* EditorOption.mouseWheelZoom */)) {\n                return;\n            }\n            const e = new StandardWheelEvent(browserEvent);\n            const doMouseWheelZoom = (platform.isMacintosh\n                // on macOS we support cmd + two fingers scroll (`metaKey` set)\n                // and also the two fingers pinch gesture (`ctrKey` set)\n                ? ((browserEvent.metaKey || browserEvent.ctrlKey) && !browserEvent.shiftKey && !browserEvent.altKey)\n                : (browserEvent.ctrlKey && !browserEvent.metaKey && !browserEvent.shiftKey && !browserEvent.altKey));\n            if (doMouseWheelZoom) {\n                const zoomLevel = EditorZoom.getZoomLevel();\n                const delta = e.deltaY > 0 ? 1 : -1;\n                EditorZoom.setZoomLevel(zoomLevel + delta);\n                e.preventDefault();\n                e.stopPropagation();\n            }\n        };\n        this._register(dom.addDisposableListener(this.viewHelper.viewDomNode, dom.EventType.MOUSE_WHEEL, onMouseWheel, { capture: true, passive: false }));\n        this._context.addEventHandler(this);\n    }\n    dispose() {\n        this._context.removeEventHandler(this);\n        if (this._mouseLeaveMonitor) {\n            this._mouseLeaveMonitor.dispose();\n            this._mouseLeaveMonitor = null;\n        }\n        super.dispose();\n    }\n    // --- begin event handlers\n    onConfigurationChanged(e) {\n        if (e.hasChanged(133 /* EditorOption.layoutInfo */)) {\n            // layout change\n            const height = this._context.configuration.options.get(133 /* EditorOption.layoutInfo */).height;\n            if (this._height !== height) {\n                this._height = height;\n                this._mouseDownOperation.onHeightChanged();\n            }\n        }\n        return false;\n    }\n    onCursorStateChanged(e) {\n        this._mouseDownOperation.onCursorStateChanged(e);\n        return false;\n    }\n    onFocusChanged(e) {\n        return false;\n    }\n    onScrollChanged(e) {\n        this._mouseDownOperation.onScrollChanged();\n        return false;\n    }\n    // --- end event handlers\n    getTargetAtClientPoint(clientX, clientY) {\n        const clientPos = new ClientCoordinates(clientX, clientY);\n        const pos = clientPos.toPageCoordinates();\n        const editorPos = createEditorPagePosition(this.viewHelper.viewDomNode);\n        if (pos.y < editorPos.y || pos.y > editorPos.y + editorPos.height || pos.x < editorPos.x || pos.x > editorPos.x + editorPos.width) {\n            return null;\n        }\n        const relativePos = createCoordinatesRelativeToEditor(this.viewHelper.viewDomNode, editorPos, pos);\n        return this.mouseTargetFactory.createMouseTarget(this.viewHelper.getLastRenderData(), editorPos, pos, relativePos, null);\n    }\n    _createMouseTarget(e, testEventTarget) {\n        let target = e.target;\n        if (!this.viewHelper.viewDomNode.contains(target)) {\n            const shadowRoot = dom.getShadowRoot(this.viewHelper.viewDomNode);\n            if (shadowRoot) {\n                target = shadowRoot.elementsFromPoint(e.posx, e.posy).find((el) => this.viewHelper.viewDomNode.contains(el));\n            }\n        }\n        return this.mouseTargetFactory.createMouseTarget(this.viewHelper.getLastRenderData(), e.editorPos, e.pos, e.relativePos, testEventTarget ? target : null);\n    }\n    _getMouseColumn(e) {\n        return this.mouseTargetFactory.getMouseColumn(e.relativePos);\n    }\n    _onContextMenu(e, testEventTarget) {\n        this.viewController.emitContextMenu({\n            event: e,\n            target: this._createMouseTarget(e, testEventTarget)\n        });\n    }\n    _onMouseMove(e) {\n        const targetIsWidget = this.mouseTargetFactory.mouseTargetIsWidget(e);\n        if (!targetIsWidget) {\n            e.preventDefault();\n        }\n        if (this._mouseDownOperation.isActive()) {\n            // In selection/drag operation\n            return;\n        }\n        const actualMouseMoveTime = e.timestamp;\n        if (actualMouseMoveTime < this.lastMouseLeaveTime) {\n            // Due to throttling, this event occurred before the mouse left the editor, therefore ignore it.\n            return;\n        }\n        this.viewController.emitMouseMove({\n            event: e,\n            target: this._createMouseTarget(e, true)\n        });\n    }\n    _onMouseLeave(e) {\n        if (this._mouseLeaveMonitor) {\n            this._mouseLeaveMonitor.dispose();\n            this._mouseLeaveMonitor = null;\n        }\n        this.lastMouseLeaveTime = (new Date()).getTime();\n        this.viewController.emitMouseLeave({\n            event: e,\n            target: null\n        });\n    }\n    _onMouseUp(e) {\n        this.viewController.emitMouseUp({\n            event: e,\n            target: this._createMouseTarget(e, true)\n        });\n    }\n    _onMouseDown(e, pointerId) {\n        const t = this._createMouseTarget(e, true);\n        const targetIsContent = (t.type === 6 /* MouseTargetType.CONTENT_TEXT */ || t.type === 7 /* MouseTargetType.CONTENT_EMPTY */);\n        const targetIsGutter = (t.type === 2 /* MouseTargetType.GUTTER_GLYPH_MARGIN */ || t.type === 3 /* MouseTargetType.GUTTER_LINE_NUMBERS */ || t.type === 4 /* MouseTargetType.GUTTER_LINE_DECORATIONS */);\n        const targetIsLineNumbers = (t.type === 3 /* MouseTargetType.GUTTER_LINE_NUMBERS */);\n        const selectOnLineNumbers = this._context.configuration.options.get(100 /* EditorOption.selectOnLineNumbers */);\n        const targetIsViewZone = (t.type === 8 /* MouseTargetType.CONTENT_VIEW_ZONE */ || t.type === 5 /* MouseTargetType.GUTTER_VIEW_ZONE */);\n        const targetIsWidget = (t.type === 9 /* MouseTargetType.CONTENT_WIDGET */);\n        let shouldHandle = e.leftButton || e.middleButton;\n        if (platform.isMacintosh && e.leftButton && e.ctrlKey) {\n            shouldHandle = false;\n        }\n        const focus = () => {\n            e.preventDefault();\n            this.viewHelper.focusTextArea();\n        };\n        if (shouldHandle && (targetIsContent || (targetIsLineNumbers && selectOnLineNumbers))) {\n            focus();\n            this._mouseDownOperation.start(t.type, e, pointerId);\n        }\n        else if (targetIsGutter) {\n            // Do not steal focus\n            e.preventDefault();\n        }\n        else if (targetIsViewZone) {\n            const viewZoneData = t.detail;\n            if (shouldHandle && this.viewHelper.shouldSuppressMouseDownOnViewZone(viewZoneData.viewZoneId)) {\n                focus();\n                this._mouseDownOperation.start(t.type, e, pointerId);\n                e.preventDefault();\n            }\n        }\n        else if (targetIsWidget && this.viewHelper.shouldSuppressMouseDownOnWidget(t.detail)) {\n            focus();\n            e.preventDefault();\n        }\n        this.viewController.emitMouseDown({\n            event: e,\n            target: t\n        });\n    }\n}\nclass MouseDownOperation extends Disposable {\n    constructor(context, viewController, viewHelper, createMouseTarget, getMouseColumn) {\n        super();\n        this._context = context;\n        this._viewController = viewController;\n        this._viewHelper = viewHelper;\n        this._createMouseTarget = createMouseTarget;\n        this._getMouseColumn = getMouseColumn;\n        this._mouseMoveMonitor = this._register(new GlobalEditorPointerMoveMonitor(this._viewHelper.viewDomNode));\n        this._onScrollTimeout = this._register(new TimeoutTimer());\n        this._mouseState = new MouseDownState();\n        this._currentSelection = new Selection(1, 1, 1, 1);\n        this._isActive = false;\n        this._lastMouseEvent = null;\n    }\n    dispose() {\n        super.dispose();\n    }\n    isActive() {\n        return this._isActive;\n    }\n    _onMouseDownThenMove(e) {\n        this._lastMouseEvent = e;\n        this._mouseState.setModifiers(e);\n        const position = this._findMousePosition(e, false);\n        if (!position) {\n            // Ignoring because position is unknown\n            return;\n        }\n        if (this._mouseState.isDragAndDrop) {\n            this._viewController.emitMouseDrag({\n                event: e,\n                target: position\n            });\n        }\n        else {\n            this._dispatchMouse(position, true);\n        }\n    }\n    start(targetType, e, pointerId) {\n        this._lastMouseEvent = e;\n        this._mouseState.setStartedOnLineNumbers(targetType === 3 /* MouseTargetType.GUTTER_LINE_NUMBERS */);\n        this._mouseState.setStartButtons(e);\n        this._mouseState.setModifiers(e);\n        const position = this._findMousePosition(e, true);\n        if (!position || !position.position) {\n            // Ignoring because position is unknown\n            return;\n        }\n        this._mouseState.trySetCount(e.detail, position.position);\n        // Overwrite the detail of the MouseEvent, as it will be sent out in an event and contributions might rely on it.\n        e.detail = this._mouseState.count;\n        const options = this._context.configuration.options;\n        if (!options.get(83 /* EditorOption.readOnly */)\n            && options.get(31 /* EditorOption.dragAndDrop */)\n            && !options.get(18 /* EditorOption.columnSelection */)\n            && !this._mouseState.altKey // we don't support multiple mouse\n            && e.detail < 2 // only single click on a selection can work\n            && !this._isActive // the mouse is not down yet\n            && !this._currentSelection.isEmpty() // we don't drag single cursor\n            && (position.type === 6 /* MouseTargetType.CONTENT_TEXT */) // single click on text\n            && position.position && this._currentSelection.containsPosition(position.position) // single click on a selection\n        ) {\n            this._mouseState.isDragAndDrop = true;\n            this._isActive = true;\n            this._mouseMoveMonitor.startMonitoring(this._viewHelper.viewLinesDomNode, pointerId, e.buttons, (e) => this._onMouseDownThenMove(e), (browserEvent) => {\n                const position = this._findMousePosition(this._lastMouseEvent, false);\n                if (browserEvent && browserEvent instanceof KeyboardEvent) {\n                    // cancel\n                    this._viewController.emitMouseDropCanceled();\n                }\n                else {\n                    this._viewController.emitMouseDrop({\n                        event: this._lastMouseEvent,\n                        target: (position ? this._createMouseTarget(this._lastMouseEvent, true) : null) // Ignoring because position is unknown, e.g., Content View Zone\n                    });\n                }\n                this._stop();\n            });\n            return;\n        }\n        this._mouseState.isDragAndDrop = false;\n        this._dispatchMouse(position, e.shiftKey);\n        if (!this._isActive) {\n            this._isActive = true;\n            this._mouseMoveMonitor.startMonitoring(this._viewHelper.viewLinesDomNode, pointerId, e.buttons, (e) => this._onMouseDownThenMove(e), () => this._stop());\n        }\n    }\n    _stop() {\n        this._isActive = false;\n        this._onScrollTimeout.cancel();\n    }\n    onHeightChanged() {\n        this._mouseMoveMonitor.stopMonitoring();\n    }\n    onPointerUp() {\n        this._mouseMoveMonitor.stopMonitoring();\n    }\n    onScrollChanged() {\n        if (!this._isActive) {\n            return;\n        }\n        this._onScrollTimeout.setIfNotSet(() => {\n            if (!this._lastMouseEvent) {\n                return;\n            }\n            const position = this._findMousePosition(this._lastMouseEvent, false);\n            if (!position) {\n                // Ignoring because position is unknown\n                return;\n            }\n            if (this._mouseState.isDragAndDrop) {\n                // Ignoring because users are dragging the text\n                return;\n            }\n            this._dispatchMouse(position, true);\n        }, 10);\n    }\n    onCursorStateChanged(e) {\n        this._currentSelection = e.selections[0];\n    }\n    _getPositionOutsideEditor(e) {\n        const editorContent = e.editorPos;\n        const model = this._context.viewModel;\n        const viewLayout = this._context.viewLayout;\n        const mouseColumn = this._getMouseColumn(e);\n        if (e.posy < editorContent.y) {\n            const verticalOffset = Math.max(viewLayout.getCurrentScrollTop() - (editorContent.y - e.posy), 0);\n            const viewZoneData = HitTestContext.getZoneAtCoord(this._context, verticalOffset);\n            if (viewZoneData) {\n                const newPosition = this._helpPositionJumpOverViewZone(viewZoneData);\n                if (newPosition) {\n                    return MouseTarget.createOutsideEditor(mouseColumn, newPosition);\n                }\n            }\n            const aboveLineNumber = viewLayout.getLineNumberAtVerticalOffset(verticalOffset);\n            return MouseTarget.createOutsideEditor(mouseColumn, new Position(aboveLineNumber, 1));\n        }\n        if (e.posy > editorContent.y + editorContent.height) {\n            const verticalOffset = viewLayout.getCurrentScrollTop() + e.relativePos.y;\n            const viewZoneData = HitTestContext.getZoneAtCoord(this._context, verticalOffset);\n            if (viewZoneData) {\n                const newPosition = this._helpPositionJumpOverViewZone(viewZoneData);\n                if (newPosition) {\n                    return MouseTarget.createOutsideEditor(mouseColumn, newPosition);\n                }\n            }\n            const belowLineNumber = viewLayout.getLineNumberAtVerticalOffset(verticalOffset);\n            return MouseTarget.createOutsideEditor(mouseColumn, new Position(belowLineNumber, model.getLineMaxColumn(belowLineNumber)));\n        }\n        const possibleLineNumber = viewLayout.getLineNumberAtVerticalOffset(viewLayout.getCurrentScrollTop() + e.relativePos.y);\n        if (e.posx < editorContent.x) {\n            return MouseTarget.createOutsideEditor(mouseColumn, new Position(possibleLineNumber, 1));\n        }\n        if (e.posx > editorContent.x + editorContent.width) {\n            return MouseTarget.createOutsideEditor(mouseColumn, new Position(possibleLineNumber, model.getLineMaxColumn(possibleLineNumber)));\n        }\n        return null;\n    }\n    _findMousePosition(e, testEventTarget) {\n        const positionOutsideEditor = this._getPositionOutsideEditor(e);\n        if (positionOutsideEditor) {\n            return positionOutsideEditor;\n        }\n        const t = this._createMouseTarget(e, testEventTarget);\n        const hintedPosition = t.position;\n        if (!hintedPosition) {\n            return null;\n        }\n        if (t.type === 8 /* MouseTargetType.CONTENT_VIEW_ZONE */ || t.type === 5 /* MouseTargetType.GUTTER_VIEW_ZONE */) {\n            const newPosition = this._helpPositionJumpOverViewZone(t.detail);\n            if (newPosition) {\n                return MouseTarget.createViewZone(t.type, t.element, t.mouseColumn, newPosition, t.detail);\n            }\n        }\n        return t;\n    }\n    _helpPositionJumpOverViewZone(viewZoneData) {\n        // Force position on view zones to go above or below depending on where selection started from\n        const selectionStart = new Position(this._currentSelection.selectionStartLineNumber, this._currentSelection.selectionStartColumn);\n        const positionBefore = viewZoneData.positionBefore;\n        const positionAfter = viewZoneData.positionAfter;\n        if (positionBefore && positionAfter) {\n            if (positionBefore.isBefore(selectionStart)) {\n                return positionBefore;\n            }\n            else {\n                return positionAfter;\n            }\n        }\n        return null;\n    }\n    _dispatchMouse(position, inSelectionMode) {\n        if (!position.position) {\n            return;\n        }\n        this._viewController.dispatchMouse({\n            position: position.position,\n            mouseColumn: position.mouseColumn,\n            startedOnLineNumbers: this._mouseState.startedOnLineNumbers,\n            inSelectionMode: inSelectionMode,\n            mouseDownCount: this._mouseState.count,\n            altKey: this._mouseState.altKey,\n            ctrlKey: this._mouseState.ctrlKey,\n            metaKey: this._mouseState.metaKey,\n            shiftKey: this._mouseState.shiftKey,\n            leftButton: this._mouseState.leftButton,\n            middleButton: this._mouseState.middleButton,\n            onInjectedText: position.type === 6 /* MouseTargetType.CONTENT_TEXT */ && position.detail.injectedText !== null\n        });\n    }\n}\nclass MouseDownState {\n    constructor() {\n        this._altKey = false;\n        this._ctrlKey = false;\n        this._metaKey = false;\n        this._shiftKey = false;\n        this._leftButton = false;\n        this._middleButton = false;\n        this._startedOnLineNumbers = false;\n        this._lastMouseDownPosition = null;\n        this._lastMouseDownPositionEqualCount = 0;\n        this._lastMouseDownCount = 0;\n        this._lastSetMouseDownCountTime = 0;\n        this.isDragAndDrop = false;\n    }\n    get altKey() { return this._altKey; }\n    get ctrlKey() { return this._ctrlKey; }\n    get metaKey() { return this._metaKey; }\n    get shiftKey() { return this._shiftKey; }\n    get leftButton() { return this._leftButton; }\n    get middleButton() { return this._middleButton; }\n    get startedOnLineNumbers() { return this._startedOnLineNumbers; }\n    get count() {\n        return this._lastMouseDownCount;\n    }\n    setModifiers(source) {\n        this._altKey = source.altKey;\n        this._ctrlKey = source.ctrlKey;\n        this._metaKey = source.metaKey;\n        this._shiftKey = source.shiftKey;\n    }\n    setStartButtons(source) {\n        this._leftButton = source.leftButton;\n        this._middleButton = source.middleButton;\n    }\n    setStartedOnLineNumbers(startedOnLineNumbers) {\n        this._startedOnLineNumbers = startedOnLineNumbers;\n    }\n    trySetCount(setMouseDownCount, newMouseDownPosition) {\n        // a. Invalidate multiple clicking if too much time has passed (will be hit by IE because the detail field of mouse events contains garbage in IE10)\n        const currentTime = (new Date()).getTime();\n        if (currentTime - this._lastSetMouseDownCountTime > MouseDownState.CLEAR_MOUSE_DOWN_COUNT_TIME) {\n            setMouseDownCount = 1;\n        }\n        this._lastSetMouseDownCountTime = currentTime;\n        // b. Ensure that we don't jump from single click to triple click in one go (will be hit by IE because the detail field of mouse events contains garbage in IE10)\n        if (setMouseDownCount > this._lastMouseDownCount + 1) {\n            setMouseDownCount = this._lastMouseDownCount + 1;\n        }\n        // c. Invalidate multiple clicking if the logical position is different\n        if (this._lastMouseDownPosition && this._lastMouseDownPosition.equals(newMouseDownPosition)) {\n            this._lastMouseDownPositionEqualCount++;\n        }\n        else {\n            this._lastMouseDownPositionEqualCount = 1;\n        }\n        this._lastMouseDownPosition = newMouseDownPosition;\n        // Finally set the lastMouseDownCount\n        this._lastMouseDownCount = Math.min(setMouseDownCount, this._lastMouseDownPositionEqualCount);\n    }\n}\nMouseDownState.CLEAR_MOUSE_DOWN_COUNT_TIME = 400; // ms\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}