{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport * as nls from '../../../nls.js';\nimport { onUnexpectedError } from '../../../base/common/errors.js';\nimport { Selection } from '../core/selection.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { TextChange, compressConsecutiveTextChanges } from '../core/textChange.js';\nimport * as buffer from '../../../base/common/buffer.js';\nimport { basename } from '../../../base/common/resources.js';\nfunction uriGetComparisonKey(resource) {\n  return resource.toString();\n}\nexport class SingleModelEditStackData {\n  constructor(beforeVersionId, afterVersionId, beforeEOL, afterEOL, beforeCursorState, afterCursorState, changes) {\n    this.beforeVersionId = beforeVersionId;\n    this.afterVersionId = afterVersionId;\n    this.beforeEOL = beforeEOL;\n    this.afterEOL = afterEOL;\n    this.beforeCursorState = beforeCursorState;\n    this.afterCursorState = afterCursorState;\n    this.changes = changes;\n  }\n  static create(model, beforeCursorState) {\n    const alternativeVersionId = model.getAlternativeVersionId();\n    const eol = getModelEOL(model);\n    return new SingleModelEditStackData(alternativeVersionId, alternativeVersionId, eol, eol, beforeCursorState, beforeCursorState, []);\n  }\n  append(model, textChanges, afterEOL, afterVersionId, afterCursorState) {\n    if (textChanges.length > 0) {\n      this.changes = compressConsecutiveTextChanges(this.changes, textChanges);\n    }\n    this.afterEOL = afterEOL;\n    this.afterVersionId = afterVersionId;\n    this.afterCursorState = afterCursorState;\n  }\n  static _writeSelectionsSize(selections) {\n    return 4 + 4 * 4 * (selections ? selections.length : 0);\n  }\n  static _writeSelections(b, selections, offset) {\n    buffer.writeUInt32BE(b, selections ? selections.length : 0, offset);\n    offset += 4;\n    if (selections) {\n      for (const selection of selections) {\n        buffer.writeUInt32BE(b, selection.selectionStartLineNumber, offset);\n        offset += 4;\n        buffer.writeUInt32BE(b, selection.selectionStartColumn, offset);\n        offset += 4;\n        buffer.writeUInt32BE(b, selection.positionLineNumber, offset);\n        offset += 4;\n        buffer.writeUInt32BE(b, selection.positionColumn, offset);\n        offset += 4;\n      }\n    }\n    return offset;\n  }\n  static _readSelections(b, offset, dest) {\n    const count = buffer.readUInt32BE(b, offset);\n    offset += 4;\n    for (let i = 0; i < count; i++) {\n      const selectionStartLineNumber = buffer.readUInt32BE(b, offset);\n      offset += 4;\n      const selectionStartColumn = buffer.readUInt32BE(b, offset);\n      offset += 4;\n      const positionLineNumber = buffer.readUInt32BE(b, offset);\n      offset += 4;\n      const positionColumn = buffer.readUInt32BE(b, offset);\n      offset += 4;\n      dest.push(new Selection(selectionStartLineNumber, selectionStartColumn, positionLineNumber, positionColumn));\n    }\n    return offset;\n  }\n  serialize() {\n    let necessarySize = +4 // beforeVersionId\n    + 4 // afterVersionId\n    + 1 // beforeEOL\n    + 1 // afterEOL\n    + SingleModelEditStackData._writeSelectionsSize(this.beforeCursorState) + SingleModelEditStackData._writeSelectionsSize(this.afterCursorState) + 4 // change count\n    ;\n\n    for (const change of this.changes) {\n      necessarySize += change.writeSize();\n    }\n    const b = new Uint8Array(necessarySize);\n    let offset = 0;\n    buffer.writeUInt32BE(b, this.beforeVersionId, offset);\n    offset += 4;\n    buffer.writeUInt32BE(b, this.afterVersionId, offset);\n    offset += 4;\n    buffer.writeUInt8(b, this.beforeEOL, offset);\n    offset += 1;\n    buffer.writeUInt8(b, this.afterEOL, offset);\n    offset += 1;\n    offset = SingleModelEditStackData._writeSelections(b, this.beforeCursorState, offset);\n    offset = SingleModelEditStackData._writeSelections(b, this.afterCursorState, offset);\n    buffer.writeUInt32BE(b, this.changes.length, offset);\n    offset += 4;\n    for (const change of this.changes) {\n      offset = change.write(b, offset);\n    }\n    return b.buffer;\n  }\n  static deserialize(source) {\n    const b = new Uint8Array(source);\n    let offset = 0;\n    const beforeVersionId = buffer.readUInt32BE(b, offset);\n    offset += 4;\n    const afterVersionId = buffer.readUInt32BE(b, offset);\n    offset += 4;\n    const beforeEOL = buffer.readUInt8(b, offset);\n    offset += 1;\n    const afterEOL = buffer.readUInt8(b, offset);\n    offset += 1;\n    const beforeCursorState = [];\n    offset = SingleModelEditStackData._readSelections(b, offset, beforeCursorState);\n    const afterCursorState = [];\n    offset = SingleModelEditStackData._readSelections(b, offset, afterCursorState);\n    const changeCount = buffer.readUInt32BE(b, offset);\n    offset += 4;\n    const changes = [];\n    for (let i = 0; i < changeCount; i++) {\n      offset = TextChange.read(b, offset, changes);\n    }\n    return new SingleModelEditStackData(beforeVersionId, afterVersionId, beforeEOL, afterEOL, beforeCursorState, afterCursorState, changes);\n  }\n}\nexport class SingleModelEditStackElement {\n  constructor(label, code, model, beforeCursorState) {\n    this.label = label;\n    this.code = code;\n    this.model = model;\n    this._data = SingleModelEditStackData.create(model, beforeCursorState);\n  }\n  get type() {\n    return 0 /* UndoRedoElementType.Resource */;\n  }\n\n  get resource() {\n    if (URI.isUri(this.model)) {\n      return this.model;\n    }\n    return this.model.uri;\n  }\n  toString() {\n    const data = this._data instanceof SingleModelEditStackData ? this._data : SingleModelEditStackData.deserialize(this._data);\n    return data.changes.map(change => change.toString()).join(', ');\n  }\n  matchesResource(resource) {\n    const uri = URI.isUri(this.model) ? this.model : this.model.uri;\n    return uri.toString() === resource.toString();\n  }\n  setModel(model) {\n    this.model = model;\n  }\n  canAppend(model) {\n    return this.model === model && this._data instanceof SingleModelEditStackData;\n  }\n  append(model, textChanges, afterEOL, afterVersionId, afterCursorState) {\n    if (this._data instanceof SingleModelEditStackData) {\n      this._data.append(model, textChanges, afterEOL, afterVersionId, afterCursorState);\n    }\n  }\n  close() {\n    if (this._data instanceof SingleModelEditStackData) {\n      this._data = this._data.serialize();\n    }\n  }\n  open() {\n    if (!(this._data instanceof SingleModelEditStackData)) {\n      this._data = SingleModelEditStackData.deserialize(this._data);\n    }\n  }\n  undo() {\n    if (URI.isUri(this.model)) {\n      // don't have a model\n      throw new Error(`Invalid SingleModelEditStackElement`);\n    }\n    if (this._data instanceof SingleModelEditStackData) {\n      this._data = this._data.serialize();\n    }\n    const data = SingleModelEditStackData.deserialize(this._data);\n    this.model._applyUndo(data.changes, data.beforeEOL, data.beforeVersionId, data.beforeCursorState);\n  }\n  redo() {\n    if (URI.isUri(this.model)) {\n      // don't have a model\n      throw new Error(`Invalid SingleModelEditStackElement`);\n    }\n    if (this._data instanceof SingleModelEditStackData) {\n      this._data = this._data.serialize();\n    }\n    const data = SingleModelEditStackData.deserialize(this._data);\n    this.model._applyRedo(data.changes, data.afterEOL, data.afterVersionId, data.afterCursorState);\n  }\n  heapSize() {\n    if (this._data instanceof SingleModelEditStackData) {\n      this._data = this._data.serialize();\n    }\n    return this._data.byteLength + 168 /*heap overhead*/;\n  }\n}\n\nexport class MultiModelEditStackElement {\n  constructor(label, code, editStackElements) {\n    this.label = label;\n    this.code = code;\n    this.type = 1 /* UndoRedoElementType.Workspace */;\n    this._isOpen = true;\n    this._editStackElementsArr = editStackElements.slice(0);\n    this._editStackElementsMap = new Map();\n    for (const editStackElement of this._editStackElementsArr) {\n      const key = uriGetComparisonKey(editStackElement.resource);\n      this._editStackElementsMap.set(key, editStackElement);\n    }\n    this._delegate = null;\n  }\n  get resources() {\n    return this._editStackElementsArr.map(editStackElement => editStackElement.resource);\n  }\n  prepareUndoRedo() {\n    if (this._delegate) {\n      return this._delegate.prepareUndoRedo(this);\n    }\n  }\n  matchesResource(resource) {\n    const key = uriGetComparisonKey(resource);\n    return this._editStackElementsMap.has(key);\n  }\n  setModel(model) {\n    const key = uriGetComparisonKey(URI.isUri(model) ? model : model.uri);\n    if (this._editStackElementsMap.has(key)) {\n      this._editStackElementsMap.get(key).setModel(model);\n    }\n  }\n  canAppend(model) {\n    if (!this._isOpen) {\n      return false;\n    }\n    const key = uriGetComparisonKey(model.uri);\n    if (this._editStackElementsMap.has(key)) {\n      const editStackElement = this._editStackElementsMap.get(key);\n      return editStackElement.canAppend(model);\n    }\n    return false;\n  }\n  append(model, textChanges, afterEOL, afterVersionId, afterCursorState) {\n    const key = uriGetComparisonKey(model.uri);\n    const editStackElement = this._editStackElementsMap.get(key);\n    editStackElement.append(model, textChanges, afterEOL, afterVersionId, afterCursorState);\n  }\n  close() {\n    this._isOpen = false;\n  }\n  open() {\n    // cannot reopen\n  }\n  undo() {\n    this._isOpen = false;\n    for (const editStackElement of this._editStackElementsArr) {\n      editStackElement.undo();\n    }\n  }\n  redo() {\n    for (const editStackElement of this._editStackElementsArr) {\n      editStackElement.redo();\n    }\n  }\n  heapSize(resource) {\n    const key = uriGetComparisonKey(resource);\n    if (this._editStackElementsMap.has(key)) {\n      const editStackElement = this._editStackElementsMap.get(key);\n      return editStackElement.heapSize();\n    }\n    return 0;\n  }\n  split() {\n    return this._editStackElementsArr;\n  }\n  toString() {\n    const result = [];\n    for (const editStackElement of this._editStackElementsArr) {\n      result.push(`${basename(editStackElement.resource)}: ${editStackElement}`);\n    }\n    return `{${result.join(', ')}}`;\n  }\n}\nfunction getModelEOL(model) {\n  const eol = model.getEOL();\n  if (eol === '\\n') {\n    return 0 /* EndOfLineSequence.LF */;\n  } else {\n    return 1 /* EndOfLineSequence.CRLF */;\n  }\n}\n\nexport function isEditStackElement(element) {\n  if (!element) {\n    return false;\n  }\n  return element instanceof SingleModelEditStackElement || element instanceof MultiModelEditStackElement;\n}\nexport class EditStack {\n  constructor(model, undoRedoService) {\n    this._model = model;\n    this._undoRedoService = undoRedoService;\n  }\n  pushStackElement() {\n    const lastElement = this._undoRedoService.getLastElement(this._model.uri);\n    if (isEditStackElement(lastElement)) {\n      lastElement.close();\n    }\n  }\n  popStackElement() {\n    const lastElement = this._undoRedoService.getLastElement(this._model.uri);\n    if (isEditStackElement(lastElement)) {\n      lastElement.open();\n    }\n  }\n  clear() {\n    this._undoRedoService.removeElements(this._model.uri);\n  }\n  _getOrCreateEditStackElement(beforeCursorState) {\n    const lastElement = this._undoRedoService.getLastElement(this._model.uri);\n    if (isEditStackElement(lastElement) && lastElement.canAppend(this._model)) {\n      return lastElement;\n    }\n    const newElement = new SingleModelEditStackElement(nls.localize('edit', \"Typing\"), 'undoredo.textBufferEdit', this._model, beforeCursorState);\n    this._undoRedoService.pushElement(newElement);\n    return newElement;\n  }\n  pushEOL(eol) {\n    const editStackElement = this._getOrCreateEditStackElement(null);\n    this._model.setEOL(eol);\n    editStackElement.append(this._model, [], getModelEOL(this._model), this._model.getAlternativeVersionId(), null);\n  }\n  pushEditOperation(beforeCursorState, editOperations, cursorStateComputer) {\n    const editStackElement = this._getOrCreateEditStackElement(beforeCursorState);\n    const inverseEditOperations = this._model.applyEdits(editOperations, true);\n    const afterCursorState = EditStack._computeCursorState(cursorStateComputer, inverseEditOperations);\n    const textChanges = inverseEditOperations.map((op, index) => ({\n      index: index,\n      textChange: op.textChange\n    }));\n    textChanges.sort((a, b) => {\n      if (a.textChange.oldPosition === b.textChange.oldPosition) {\n        return a.index - b.index;\n      }\n      return a.textChange.oldPosition - b.textChange.oldPosition;\n    });\n    editStackElement.append(this._model, textChanges.map(op => op.textChange), getModelEOL(this._model), this._model.getAlternativeVersionId(), afterCursorState);\n    return afterCursorState;\n  }\n  static _computeCursorState(cursorStateComputer, inverseEditOperations) {\n    try {\n      return cursorStateComputer ? cursorStateComputer(inverseEditOperations) : null;\n    } catch (e) {\n      onUnexpectedError(e);\n      return null;\n    }\n  }\n}","map":{"version":3,"names":["nls","onUnexpectedError","Selection","URI","TextChange","compressConsecutiveTextChanges","buffer","basename","uriGetComparisonKey","resource","toString","SingleModelEditStackData","constructor","beforeVersionId","afterVersionId","beforeEOL","afterEOL","beforeCursorState","afterCursorState","changes","create","model","alternativeVersionId","getAlternativeVersionId","eol","getModelEOL","append","textChanges","length","_writeSelectionsSize","selections","_writeSelections","b","offset","writeUInt32BE","selection","selectionStartLineNumber","selectionStartColumn","positionLineNumber","positionColumn","_readSelections","dest","count","readUInt32BE","i","push","serialize","necessarySize","change","writeSize","Uint8Array","writeUInt8","write","deserialize","source","readUInt8","changeCount","read","SingleModelEditStackElement","label","code","_data","type","isUri","uri","data","map","join","matchesResource","setModel","canAppend","close","open","undo","Error","_applyUndo","redo","_applyRedo","heapSize","byteLength","MultiModelEditStackElement","editStackElements","_isOpen","_editStackElementsArr","slice","_editStackElementsMap","Map","editStackElement","key","set","_delegate","resources","prepareUndoRedo","has","get","split","result","getEOL","isEditStackElement","element","EditStack","undoRedoService","_model","_undoRedoService","pushStackElement","lastElement","getLastElement","popStackElement","clear","removeElements","_getOrCreateEditStackElement","newElement","localize","pushElement","pushEOL","setEOL","pushEditOperation","editOperations","cursorStateComputer","inverseEditOperations","applyEdits","_computeCursorState","op","index","textChange","sort","a","oldPosition","e"],"sources":["/home/deathblade287/Desktop/AI-MODELS-TESTING/react-app/node_modules/monaco-editor/esm/vs/editor/common/model/editStack.js"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport * as nls from '../../../nls.js';\nimport { onUnexpectedError } from '../../../base/common/errors.js';\nimport { Selection } from '../core/selection.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { TextChange, compressConsecutiveTextChanges } from '../core/textChange.js';\nimport * as buffer from '../../../base/common/buffer.js';\nimport { basename } from '../../../base/common/resources.js';\nfunction uriGetComparisonKey(resource) {\n    return resource.toString();\n}\nexport class SingleModelEditStackData {\n    constructor(beforeVersionId, afterVersionId, beforeEOL, afterEOL, beforeCursorState, afterCursorState, changes) {\n        this.beforeVersionId = beforeVersionId;\n        this.afterVersionId = afterVersionId;\n        this.beforeEOL = beforeEOL;\n        this.afterEOL = afterEOL;\n        this.beforeCursorState = beforeCursorState;\n        this.afterCursorState = afterCursorState;\n        this.changes = changes;\n    }\n    static create(model, beforeCursorState) {\n        const alternativeVersionId = model.getAlternativeVersionId();\n        const eol = getModelEOL(model);\n        return new SingleModelEditStackData(alternativeVersionId, alternativeVersionId, eol, eol, beforeCursorState, beforeCursorState, []);\n    }\n    append(model, textChanges, afterEOL, afterVersionId, afterCursorState) {\n        if (textChanges.length > 0) {\n            this.changes = compressConsecutiveTextChanges(this.changes, textChanges);\n        }\n        this.afterEOL = afterEOL;\n        this.afterVersionId = afterVersionId;\n        this.afterCursorState = afterCursorState;\n    }\n    static _writeSelectionsSize(selections) {\n        return 4 + 4 * 4 * (selections ? selections.length : 0);\n    }\n    static _writeSelections(b, selections, offset) {\n        buffer.writeUInt32BE(b, (selections ? selections.length : 0), offset);\n        offset += 4;\n        if (selections) {\n            for (const selection of selections) {\n                buffer.writeUInt32BE(b, selection.selectionStartLineNumber, offset);\n                offset += 4;\n                buffer.writeUInt32BE(b, selection.selectionStartColumn, offset);\n                offset += 4;\n                buffer.writeUInt32BE(b, selection.positionLineNumber, offset);\n                offset += 4;\n                buffer.writeUInt32BE(b, selection.positionColumn, offset);\n                offset += 4;\n            }\n        }\n        return offset;\n    }\n    static _readSelections(b, offset, dest) {\n        const count = buffer.readUInt32BE(b, offset);\n        offset += 4;\n        for (let i = 0; i < count; i++) {\n            const selectionStartLineNumber = buffer.readUInt32BE(b, offset);\n            offset += 4;\n            const selectionStartColumn = buffer.readUInt32BE(b, offset);\n            offset += 4;\n            const positionLineNumber = buffer.readUInt32BE(b, offset);\n            offset += 4;\n            const positionColumn = buffer.readUInt32BE(b, offset);\n            offset += 4;\n            dest.push(new Selection(selectionStartLineNumber, selectionStartColumn, positionLineNumber, positionColumn));\n        }\n        return offset;\n    }\n    serialize() {\n        let necessarySize = (+4 // beforeVersionId\n            + 4 // afterVersionId\n            + 1 // beforeEOL\n            + 1 // afterEOL\n            + SingleModelEditStackData._writeSelectionsSize(this.beforeCursorState)\n            + SingleModelEditStackData._writeSelectionsSize(this.afterCursorState)\n            + 4 // change count\n        );\n        for (const change of this.changes) {\n            necessarySize += change.writeSize();\n        }\n        const b = new Uint8Array(necessarySize);\n        let offset = 0;\n        buffer.writeUInt32BE(b, this.beforeVersionId, offset);\n        offset += 4;\n        buffer.writeUInt32BE(b, this.afterVersionId, offset);\n        offset += 4;\n        buffer.writeUInt8(b, this.beforeEOL, offset);\n        offset += 1;\n        buffer.writeUInt8(b, this.afterEOL, offset);\n        offset += 1;\n        offset = SingleModelEditStackData._writeSelections(b, this.beforeCursorState, offset);\n        offset = SingleModelEditStackData._writeSelections(b, this.afterCursorState, offset);\n        buffer.writeUInt32BE(b, this.changes.length, offset);\n        offset += 4;\n        for (const change of this.changes) {\n            offset = change.write(b, offset);\n        }\n        return b.buffer;\n    }\n    static deserialize(source) {\n        const b = new Uint8Array(source);\n        let offset = 0;\n        const beforeVersionId = buffer.readUInt32BE(b, offset);\n        offset += 4;\n        const afterVersionId = buffer.readUInt32BE(b, offset);\n        offset += 4;\n        const beforeEOL = buffer.readUInt8(b, offset);\n        offset += 1;\n        const afterEOL = buffer.readUInt8(b, offset);\n        offset += 1;\n        const beforeCursorState = [];\n        offset = SingleModelEditStackData._readSelections(b, offset, beforeCursorState);\n        const afterCursorState = [];\n        offset = SingleModelEditStackData._readSelections(b, offset, afterCursorState);\n        const changeCount = buffer.readUInt32BE(b, offset);\n        offset += 4;\n        const changes = [];\n        for (let i = 0; i < changeCount; i++) {\n            offset = TextChange.read(b, offset, changes);\n        }\n        return new SingleModelEditStackData(beforeVersionId, afterVersionId, beforeEOL, afterEOL, beforeCursorState, afterCursorState, changes);\n    }\n}\nexport class SingleModelEditStackElement {\n    constructor(label, code, model, beforeCursorState) {\n        this.label = label;\n        this.code = code;\n        this.model = model;\n        this._data = SingleModelEditStackData.create(model, beforeCursorState);\n    }\n    get type() {\n        return 0 /* UndoRedoElementType.Resource */;\n    }\n    get resource() {\n        if (URI.isUri(this.model)) {\n            return this.model;\n        }\n        return this.model.uri;\n    }\n    toString() {\n        const data = (this._data instanceof SingleModelEditStackData ? this._data : SingleModelEditStackData.deserialize(this._data));\n        return data.changes.map(change => change.toString()).join(', ');\n    }\n    matchesResource(resource) {\n        const uri = (URI.isUri(this.model) ? this.model : this.model.uri);\n        return (uri.toString() === resource.toString());\n    }\n    setModel(model) {\n        this.model = model;\n    }\n    canAppend(model) {\n        return (this.model === model && this._data instanceof SingleModelEditStackData);\n    }\n    append(model, textChanges, afterEOL, afterVersionId, afterCursorState) {\n        if (this._data instanceof SingleModelEditStackData) {\n            this._data.append(model, textChanges, afterEOL, afterVersionId, afterCursorState);\n        }\n    }\n    close() {\n        if (this._data instanceof SingleModelEditStackData) {\n            this._data = this._data.serialize();\n        }\n    }\n    open() {\n        if (!(this._data instanceof SingleModelEditStackData)) {\n            this._data = SingleModelEditStackData.deserialize(this._data);\n        }\n    }\n    undo() {\n        if (URI.isUri(this.model)) {\n            // don't have a model\n            throw new Error(`Invalid SingleModelEditStackElement`);\n        }\n        if (this._data instanceof SingleModelEditStackData) {\n            this._data = this._data.serialize();\n        }\n        const data = SingleModelEditStackData.deserialize(this._data);\n        this.model._applyUndo(data.changes, data.beforeEOL, data.beforeVersionId, data.beforeCursorState);\n    }\n    redo() {\n        if (URI.isUri(this.model)) {\n            // don't have a model\n            throw new Error(`Invalid SingleModelEditStackElement`);\n        }\n        if (this._data instanceof SingleModelEditStackData) {\n            this._data = this._data.serialize();\n        }\n        const data = SingleModelEditStackData.deserialize(this._data);\n        this.model._applyRedo(data.changes, data.afterEOL, data.afterVersionId, data.afterCursorState);\n    }\n    heapSize() {\n        if (this._data instanceof SingleModelEditStackData) {\n            this._data = this._data.serialize();\n        }\n        return this._data.byteLength + 168 /*heap overhead*/;\n    }\n}\nexport class MultiModelEditStackElement {\n    constructor(label, code, editStackElements) {\n        this.label = label;\n        this.code = code;\n        this.type = 1 /* UndoRedoElementType.Workspace */;\n        this._isOpen = true;\n        this._editStackElementsArr = editStackElements.slice(0);\n        this._editStackElementsMap = new Map();\n        for (const editStackElement of this._editStackElementsArr) {\n            const key = uriGetComparisonKey(editStackElement.resource);\n            this._editStackElementsMap.set(key, editStackElement);\n        }\n        this._delegate = null;\n    }\n    get resources() {\n        return this._editStackElementsArr.map(editStackElement => editStackElement.resource);\n    }\n    prepareUndoRedo() {\n        if (this._delegate) {\n            return this._delegate.prepareUndoRedo(this);\n        }\n    }\n    matchesResource(resource) {\n        const key = uriGetComparisonKey(resource);\n        return (this._editStackElementsMap.has(key));\n    }\n    setModel(model) {\n        const key = uriGetComparisonKey(URI.isUri(model) ? model : model.uri);\n        if (this._editStackElementsMap.has(key)) {\n            this._editStackElementsMap.get(key).setModel(model);\n        }\n    }\n    canAppend(model) {\n        if (!this._isOpen) {\n            return false;\n        }\n        const key = uriGetComparisonKey(model.uri);\n        if (this._editStackElementsMap.has(key)) {\n            const editStackElement = this._editStackElementsMap.get(key);\n            return editStackElement.canAppend(model);\n        }\n        return false;\n    }\n    append(model, textChanges, afterEOL, afterVersionId, afterCursorState) {\n        const key = uriGetComparisonKey(model.uri);\n        const editStackElement = this._editStackElementsMap.get(key);\n        editStackElement.append(model, textChanges, afterEOL, afterVersionId, afterCursorState);\n    }\n    close() {\n        this._isOpen = false;\n    }\n    open() {\n        // cannot reopen\n    }\n    undo() {\n        this._isOpen = false;\n        for (const editStackElement of this._editStackElementsArr) {\n            editStackElement.undo();\n        }\n    }\n    redo() {\n        for (const editStackElement of this._editStackElementsArr) {\n            editStackElement.redo();\n        }\n    }\n    heapSize(resource) {\n        const key = uriGetComparisonKey(resource);\n        if (this._editStackElementsMap.has(key)) {\n            const editStackElement = this._editStackElementsMap.get(key);\n            return editStackElement.heapSize();\n        }\n        return 0;\n    }\n    split() {\n        return this._editStackElementsArr;\n    }\n    toString() {\n        const result = [];\n        for (const editStackElement of this._editStackElementsArr) {\n            result.push(`${basename(editStackElement.resource)}: ${editStackElement}`);\n        }\n        return `{${result.join(', ')}}`;\n    }\n}\nfunction getModelEOL(model) {\n    const eol = model.getEOL();\n    if (eol === '\\n') {\n        return 0 /* EndOfLineSequence.LF */;\n    }\n    else {\n        return 1 /* EndOfLineSequence.CRLF */;\n    }\n}\nexport function isEditStackElement(element) {\n    if (!element) {\n        return false;\n    }\n    return ((element instanceof SingleModelEditStackElement) || (element instanceof MultiModelEditStackElement));\n}\nexport class EditStack {\n    constructor(model, undoRedoService) {\n        this._model = model;\n        this._undoRedoService = undoRedoService;\n    }\n    pushStackElement() {\n        const lastElement = this._undoRedoService.getLastElement(this._model.uri);\n        if (isEditStackElement(lastElement)) {\n            lastElement.close();\n        }\n    }\n    popStackElement() {\n        const lastElement = this._undoRedoService.getLastElement(this._model.uri);\n        if (isEditStackElement(lastElement)) {\n            lastElement.open();\n        }\n    }\n    clear() {\n        this._undoRedoService.removeElements(this._model.uri);\n    }\n    _getOrCreateEditStackElement(beforeCursorState) {\n        const lastElement = this._undoRedoService.getLastElement(this._model.uri);\n        if (isEditStackElement(lastElement) && lastElement.canAppend(this._model)) {\n            return lastElement;\n        }\n        const newElement = new SingleModelEditStackElement(nls.localize('edit', \"Typing\"), 'undoredo.textBufferEdit', this._model, beforeCursorState);\n        this._undoRedoService.pushElement(newElement);\n        return newElement;\n    }\n    pushEOL(eol) {\n        const editStackElement = this._getOrCreateEditStackElement(null);\n        this._model.setEOL(eol);\n        editStackElement.append(this._model, [], getModelEOL(this._model), this._model.getAlternativeVersionId(), null);\n    }\n    pushEditOperation(beforeCursorState, editOperations, cursorStateComputer) {\n        const editStackElement = this._getOrCreateEditStackElement(beforeCursorState);\n        const inverseEditOperations = this._model.applyEdits(editOperations, true);\n        const afterCursorState = EditStack._computeCursorState(cursorStateComputer, inverseEditOperations);\n        const textChanges = inverseEditOperations.map((op, index) => ({ index: index, textChange: op.textChange }));\n        textChanges.sort((a, b) => {\n            if (a.textChange.oldPosition === b.textChange.oldPosition) {\n                return a.index - b.index;\n            }\n            return a.textChange.oldPosition - b.textChange.oldPosition;\n        });\n        editStackElement.append(this._model, textChanges.map(op => op.textChange), getModelEOL(this._model), this._model.getAlternativeVersionId(), afterCursorState);\n        return afterCursorState;\n    }\n    static _computeCursorState(cursorStateComputer, inverseEditOperations) {\n        try {\n            return cursorStateComputer ? cursorStateComputer(inverseEditOperations) : null;\n        }\n        catch (e) {\n            onUnexpectedError(e);\n            return null;\n        }\n    }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}