{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport './textAreaHandler.css';\nimport * as nls from '../../../nls.js';\nimport * as browser from '../../../base/browser/browser.js';\nimport { createFastDomNode } from '../../../base/browser/fastDomNode.js';\nimport * as platform from '../../../base/common/platform.js';\nimport * as strings from '../../../base/common/strings.js';\nimport { applyFontInfo } from '../config/domFontInfo.js';\nimport { CopyOptions, TextAreaInput, TextAreaWrapper } from './textAreaInput.js';\nimport { PagedScreenReaderStrategy, TextAreaState, _debugComposition } from './textAreaState.js';\nimport { PartFingerprints, ViewPart } from '../view/viewPart.js';\nimport { LineNumbersOverlay } from '../viewParts/lineNumbers/lineNumbers.js';\nimport { Margin } from '../viewParts/margin/margin.js';\nimport { EditorOptions } from '../../common/config/editorOptions.js';\nimport { getMapForWordSeparators } from '../../common/core/wordCharacterClassifier.js';\nimport { Position } from '../../common/core/position.js';\nimport { Range } from '../../common/core/range.js';\nimport { Selection } from '../../common/core/selection.js';\nimport { MOUSE_CURSOR_TEXT_CSS_CLASS_NAME } from '../../../base/browser/ui/mouseCursor/mouseCursor.js';\nimport { TokenizationRegistry } from '../../common/languages.js';\nimport { Color } from '../../../base/common/color.js';\nclass VisibleTextAreaData {\n  constructor(_context, modelLineNumber, distanceToModelLineStart, widthOfHiddenLineTextBefore, distanceToModelLineEnd) {\n    this._context = _context;\n    this.modelLineNumber = modelLineNumber;\n    this.distanceToModelLineStart = distanceToModelLineStart;\n    this.widthOfHiddenLineTextBefore = widthOfHiddenLineTextBefore;\n    this.distanceToModelLineEnd = distanceToModelLineEnd;\n    this._visibleTextAreaBrand = undefined;\n    this.startPosition = null;\n    this.endPosition = null;\n    this.visibleTextareaStart = null;\n    this.visibleTextareaEnd = null;\n    /**\n     * When doing composition, the currently composed text might be split up into\n     * multiple tokens, then merged again into a single token, etc. Here we attempt\n     * to keep the presentation of the <textarea> stable by using the previous used\n     * style if multiple tokens come into play. This avoids flickering.\n     */\n    this._previousPresentation = null;\n  }\n  prepareRender(visibleRangeProvider) {\n    const startModelPosition = new Position(this.modelLineNumber, this.distanceToModelLineStart + 1);\n    const endModelPosition = new Position(this.modelLineNumber, this._context.viewModel.model.getLineMaxColumn(this.modelLineNumber) - this.distanceToModelLineEnd);\n    this.startPosition = this._context.viewModel.coordinatesConverter.convertModelPositionToViewPosition(startModelPosition);\n    this.endPosition = this._context.viewModel.coordinatesConverter.convertModelPositionToViewPosition(endModelPosition);\n    if (this.startPosition.lineNumber === this.endPosition.lineNumber) {\n      this.visibleTextareaStart = visibleRangeProvider.visibleRangeForPosition(this.startPosition);\n      this.visibleTextareaEnd = visibleRangeProvider.visibleRangeForPosition(this.endPosition);\n    } else {\n      // TODO: what if the view positions are not on the same line?\n      this.visibleTextareaStart = null;\n      this.visibleTextareaEnd = null;\n    }\n  }\n  definePresentation(tokenPresentation) {\n    if (!this._previousPresentation) {\n      // To avoid flickering, once set, always reuse a presentation throughout the entire IME session\n      if (tokenPresentation) {\n        this._previousPresentation = tokenPresentation;\n      } else {\n        this._previousPresentation = {\n          foreground: 1 /* ColorId.DefaultForeground */,\n          italic: false,\n          bold: false,\n          underline: false,\n          strikethrough: false\n        };\n      }\n    }\n    return this._previousPresentation;\n  }\n}\nconst canUseZeroSizeTextarea = browser.isFirefox;\nexport class TextAreaHandler extends ViewPart {\n  constructor(context, viewController, visibleRangeProvider) {\n    super(context);\n    // --- end view API\n    this._primaryCursorPosition = new Position(1, 1);\n    this._primaryCursorVisibleRange = null;\n    this._viewController = viewController;\n    this._visibleRangeProvider = visibleRangeProvider;\n    this._scrollLeft = 0;\n    this._scrollTop = 0;\n    const options = this._context.configuration.options;\n    const layoutInfo = options.get(133 /* EditorOption.layoutInfo */);\n    this._setAccessibilityOptions(options);\n    this._contentLeft = layoutInfo.contentLeft;\n    this._contentWidth = layoutInfo.contentWidth;\n    this._contentHeight = layoutInfo.height;\n    this._fontInfo = options.get(46 /* EditorOption.fontInfo */);\n    this._lineHeight = options.get(61 /* EditorOption.lineHeight */);\n    this._emptySelectionClipboard = options.get(33 /* EditorOption.emptySelectionClipboard */);\n    this._copyWithSyntaxHighlighting = options.get(21 /* EditorOption.copyWithSyntaxHighlighting */);\n    this._visibleTextArea = null;\n    this._selections = [new Selection(1, 1, 1, 1)];\n    this._modelSelections = [new Selection(1, 1, 1, 1)];\n    this._lastRenderPosition = null;\n    // Text Area (The focus will always be in the textarea when the cursor is blinking)\n    this.textArea = createFastDomNode(document.createElement('textarea'));\n    PartFingerprints.write(this.textArea, 6 /* PartFingerprint.TextArea */);\n    this.textArea.setClassName(`inputarea ${MOUSE_CURSOR_TEXT_CSS_CLASS_NAME}`);\n    this.textArea.setAttribute('wrap', 'off');\n    this.textArea.setAttribute('autocorrect', 'off');\n    this.textArea.setAttribute('autocapitalize', 'off');\n    this.textArea.setAttribute('autocomplete', 'off');\n    this.textArea.setAttribute('spellcheck', 'false');\n    this.textArea.setAttribute('aria-label', this._getAriaLabel(options));\n    this.textArea.setAttribute('tabindex', String(options.get(114 /* EditorOption.tabIndex */)));\n    this.textArea.setAttribute('role', 'textbox');\n    this.textArea.setAttribute('aria-roledescription', nls.localize('editor', \"editor\"));\n    this.textArea.setAttribute('aria-multiline', 'true');\n    this.textArea.setAttribute('aria-haspopup', 'false');\n    this.textArea.setAttribute('aria-autocomplete', 'both');\n    if (options.get(30 /* EditorOption.domReadOnly */) && options.get(83 /* EditorOption.readOnly */)) {\n      this.textArea.setAttribute('readonly', 'true');\n    }\n    this.textAreaCover = createFastDomNode(document.createElement('div'));\n    this.textAreaCover.setPosition('absolute');\n    const simpleModel = {\n      getLineCount: () => {\n        return this._context.viewModel.getLineCount();\n      },\n      getLineMaxColumn: lineNumber => {\n        return this._context.viewModel.getLineMaxColumn(lineNumber);\n      },\n      getValueInRange: (range, eol) => {\n        return this._context.viewModel.getValueInRange(range, eol);\n      }\n    };\n    const textAreaInputHost = {\n      getDataToCopy: () => {\n        const rawTextToCopy = this._context.viewModel.getPlainTextToCopy(this._modelSelections, this._emptySelectionClipboard, platform.isWindows);\n        const newLineCharacter = this._context.viewModel.model.getEOL();\n        const isFromEmptySelection = this._emptySelectionClipboard && this._modelSelections.length === 1 && this._modelSelections[0].isEmpty();\n        const multicursorText = Array.isArray(rawTextToCopy) ? rawTextToCopy : null;\n        const text = Array.isArray(rawTextToCopy) ? rawTextToCopy.join(newLineCharacter) : rawTextToCopy;\n        let html = undefined;\n        let mode = null;\n        if (CopyOptions.forceCopyWithSyntaxHighlighting || this._copyWithSyntaxHighlighting && text.length < 65536) {\n          const richText = this._context.viewModel.getRichTextToCopy(this._modelSelections, this._emptySelectionClipboard);\n          if (richText) {\n            html = richText.html;\n            mode = richText.mode;\n          }\n        }\n        return {\n          isFromEmptySelection,\n          multicursorText,\n          text,\n          html,\n          mode\n        };\n      },\n      getScreenReaderContent: currentState => {\n        if (this._accessibilitySupport === 1 /* AccessibilitySupport.Disabled */) {\n          // We know for a fact that a screen reader is not attached\n          // On OSX, we write the character before the cursor to allow for \"long-press\" composition\n          // Also on OSX, we write the word before the cursor to allow for the Accessibility Keyboard to give good hints\n          const selection = this._selections[0];\n          if (platform.isMacintosh && selection.isEmpty()) {\n            const position = selection.getStartPosition();\n            let textBefore = this._getWordBeforePosition(position);\n            if (textBefore.length === 0) {\n              textBefore = this._getCharacterBeforePosition(position);\n            }\n            if (textBefore.length > 0) {\n              return new TextAreaState(textBefore, textBefore.length, textBefore.length, position, position);\n            }\n          }\n          // on Safari, document.execCommand('cut') and document.execCommand('copy') will just not work\n          // if the textarea has no content selected. So if there is an editor selection, ensure something\n          // is selected in the textarea.\n          if (browser.isSafari && !selection.isEmpty()) {\n            const placeholderText = 'vscode-placeholder';\n            return new TextAreaState(placeholderText, 0, placeholderText.length, null, null);\n          }\n          return TextAreaState.EMPTY;\n        }\n        if (browser.isAndroid) {\n          // when tapping in the editor on a word, Android enters composition mode.\n          // in the `compositionstart` event we cannot clear the textarea, because\n          // it then forgets to ever send a `compositionend`.\n          // we therefore only write the current word in the textarea\n          const selection = this._selections[0];\n          if (selection.isEmpty()) {\n            const position = selection.getStartPosition();\n            const [wordAtPosition, positionOffsetInWord] = this._getAndroidWordAtPosition(position);\n            if (wordAtPosition.length > 0) {\n              return new TextAreaState(wordAtPosition, positionOffsetInWord, positionOffsetInWord, position, position);\n            }\n          }\n          return TextAreaState.EMPTY;\n        }\n        return PagedScreenReaderStrategy.fromEditorSelection(currentState, simpleModel, this._selections[0], this._accessibilityPageSize, this._accessibilitySupport === 0 /* AccessibilitySupport.Unknown */);\n      },\n\n      deduceModelPosition: (viewAnchorPosition, deltaOffset, lineFeedCnt) => {\n        return this._context.viewModel.deduceModelPositionRelativeToViewPosition(viewAnchorPosition, deltaOffset, lineFeedCnt);\n      }\n    };\n    const textAreaWrapper = this._register(new TextAreaWrapper(this.textArea.domNode));\n    this._textAreaInput = this._register(new TextAreaInput(textAreaInputHost, textAreaWrapper, platform.OS, browser));\n    this._register(this._textAreaInput.onKeyDown(e => {\n      this._viewController.emitKeyDown(e);\n    }));\n    this._register(this._textAreaInput.onKeyUp(e => {\n      this._viewController.emitKeyUp(e);\n    }));\n    this._register(this._textAreaInput.onPaste(e => {\n      let pasteOnNewLine = false;\n      let multicursorText = null;\n      let mode = null;\n      if (e.metadata) {\n        pasteOnNewLine = this._emptySelectionClipboard && !!e.metadata.isFromEmptySelection;\n        multicursorText = typeof e.metadata.multicursorText !== 'undefined' ? e.metadata.multicursorText : null;\n        mode = e.metadata.mode;\n      }\n      this._viewController.paste(e.text, pasteOnNewLine, multicursorText, mode);\n    }));\n    this._register(this._textAreaInput.onCut(() => {\n      this._viewController.cut();\n    }));\n    this._register(this._textAreaInput.onType(e => {\n      if (e.replacePrevCharCnt || e.replaceNextCharCnt || e.positionDelta) {\n        // must be handled through the new command\n        if (_debugComposition) {\n          console.log(` => compositionType: <<${e.text}>>, ${e.replacePrevCharCnt}, ${e.replaceNextCharCnt}, ${e.positionDelta}`);\n        }\n        this._viewController.compositionType(e.text, e.replacePrevCharCnt, e.replaceNextCharCnt, e.positionDelta);\n      } else {\n        if (_debugComposition) {\n          console.log(` => type: <<${e.text}>>`);\n        }\n        this._viewController.type(e.text);\n      }\n    }));\n    this._register(this._textAreaInput.onSelectionChangeRequest(modelSelection => {\n      this._viewController.setSelection(modelSelection);\n    }));\n    this._register(this._textAreaInput.onCompositionStart(e => {\n      // The textarea might contain some content when composition starts.\n      //\n      // When we make the textarea visible, it always has a height of 1 line,\n      // so we don't need to worry too much about content on lines above or below\n      // the selection.\n      //\n      // However, the text on the current line needs to be made visible because\n      // some IME methods allow to move to other glyphs on the current line\n      // (by pressing arrow keys).\n      //\n      // (1) The textarea might contain only some parts of the current line,\n      // like the word before the selection. Also, the content inside the textarea\n      // can grow or shrink as composition occurs. We therefore anchor the textarea\n      // in terms of distance to a certain line start and line end.\n      //\n      // (2) Also, we should not make \\t characters visible, because their rendering\n      // inside the <textarea> will not align nicely with our rendering. We therefore\n      // will hide (if necessary) some of the leading text on the current line.\n      const ta = this.textArea.domNode;\n      const modelSelection = this._modelSelections[0];\n      const {\n        distanceToModelLineStart,\n        widthOfHiddenTextBefore\n      } = (() => {\n        // Find the text that is on the current line before the selection\n        const textBeforeSelection = ta.value.substring(0, Math.min(ta.selectionStart, ta.selectionEnd));\n        const lineFeedOffset1 = textBeforeSelection.lastIndexOf('\\n');\n        const lineTextBeforeSelection = textBeforeSelection.substring(lineFeedOffset1 + 1);\n        // We now search to see if we should hide some part of it (if it contains \\t)\n        const tabOffset1 = lineTextBeforeSelection.lastIndexOf('\\t');\n        const desiredVisibleBeforeCharCount = lineTextBeforeSelection.length - tabOffset1 - 1;\n        const startModelPosition = modelSelection.getStartPosition();\n        const visibleBeforeCharCount = Math.min(startModelPosition.column - 1, desiredVisibleBeforeCharCount);\n        const distanceToModelLineStart = startModelPosition.column - 1 - visibleBeforeCharCount;\n        const hiddenLineTextBefore = lineTextBeforeSelection.substring(0, lineTextBeforeSelection.length - visibleBeforeCharCount);\n        const widthOfHiddenTextBefore = measureText(hiddenLineTextBefore, this._fontInfo);\n        return {\n          distanceToModelLineStart,\n          widthOfHiddenTextBefore\n        };\n      })();\n      const {\n        distanceToModelLineEnd\n      } = (() => {\n        // Find the text that is on the current line after the selection\n        const textAfterSelection = ta.value.substring(Math.max(ta.selectionStart, ta.selectionEnd));\n        const lineFeedOffset2 = textAfterSelection.indexOf('\\n');\n        const lineTextAfterSelection = lineFeedOffset2 === -1 ? textAfterSelection : textAfterSelection.substring(0, lineFeedOffset2);\n        const tabOffset2 = lineTextAfterSelection.indexOf('\\t');\n        const desiredVisibleAfterCharCount = tabOffset2 === -1 ? lineTextAfterSelection.length : lineTextAfterSelection.length - tabOffset2 - 1;\n        const endModelPosition = modelSelection.getEndPosition();\n        const visibleAfterCharCount = Math.min(this._context.viewModel.model.getLineMaxColumn(endModelPosition.lineNumber) - endModelPosition.column, desiredVisibleAfterCharCount);\n        const distanceToModelLineEnd = this._context.viewModel.model.getLineMaxColumn(endModelPosition.lineNumber) - endModelPosition.column - visibleAfterCharCount;\n        return {\n          distanceToModelLineEnd\n        };\n      })();\n      // Scroll to reveal the location in the editor where composition occurs\n      this._context.viewModel.revealRange('keyboard', true, Range.fromPositions(this._selections[0].getStartPosition()), 0 /* viewEvents.VerticalRevealType.Simple */, 1 /* ScrollType.Immediate */);\n      this._visibleTextArea = new VisibleTextAreaData(this._context, modelSelection.startLineNumber, distanceToModelLineStart, widthOfHiddenTextBefore, distanceToModelLineEnd);\n      this._visibleTextArea.prepareRender(this._visibleRangeProvider);\n      this._render();\n      // Show the textarea\n      this.textArea.setClassName(`inputarea ${MOUSE_CURSOR_TEXT_CSS_CLASS_NAME} ime-input`);\n      this._viewController.compositionStart();\n      this._context.viewModel.onCompositionStart();\n    }));\n    this._register(this._textAreaInput.onCompositionUpdate(e => {\n      if (!this._visibleTextArea) {\n        return;\n      }\n      this._visibleTextArea.prepareRender(this._visibleRangeProvider);\n      this._render();\n    }));\n    this._register(this._textAreaInput.onCompositionEnd(() => {\n      this._visibleTextArea = null;\n      this._render();\n      this.textArea.setClassName(`inputarea ${MOUSE_CURSOR_TEXT_CSS_CLASS_NAME}`);\n      this._viewController.compositionEnd();\n      this._context.viewModel.onCompositionEnd();\n    }));\n    this._register(this._textAreaInput.onFocus(() => {\n      this._context.viewModel.setHasFocus(true);\n    }));\n    this._register(this._textAreaInput.onBlur(() => {\n      this._context.viewModel.setHasFocus(false);\n    }));\n  }\n  dispose() {\n    super.dispose();\n  }\n  _getAndroidWordAtPosition(position) {\n    const ANDROID_WORD_SEPARATORS = '`~!@#$%^&*()-=+[{]}\\\\|;:\",.<>/?';\n    const lineContent = this._context.viewModel.getLineContent(position.lineNumber);\n    const wordSeparators = getMapForWordSeparators(ANDROID_WORD_SEPARATORS);\n    let goingLeft = true;\n    let startColumn = position.column;\n    let goingRight = true;\n    let endColumn = position.column;\n    let distance = 0;\n    while (distance < 50 && (goingLeft || goingRight)) {\n      if (goingLeft && startColumn <= 1) {\n        goingLeft = false;\n      }\n      if (goingLeft) {\n        const charCode = lineContent.charCodeAt(startColumn - 2);\n        const charClass = wordSeparators.get(charCode);\n        if (charClass !== 0 /* WordCharacterClass.Regular */) {\n          goingLeft = false;\n        } else {\n          startColumn--;\n        }\n      }\n      if (goingRight && endColumn > lineContent.length) {\n        goingRight = false;\n      }\n      if (goingRight) {\n        const charCode = lineContent.charCodeAt(endColumn - 1);\n        const charClass = wordSeparators.get(charCode);\n        if (charClass !== 0 /* WordCharacterClass.Regular */) {\n          goingRight = false;\n        } else {\n          endColumn++;\n        }\n      }\n      distance++;\n    }\n    return [lineContent.substring(startColumn - 1, endColumn - 1), position.column - startColumn];\n  }\n  _getWordBeforePosition(position) {\n    const lineContent = this._context.viewModel.getLineContent(position.lineNumber);\n    const wordSeparators = getMapForWordSeparators(this._context.configuration.options.get(119 /* EditorOption.wordSeparators */));\n    let column = position.column;\n    let distance = 0;\n    while (column > 1) {\n      const charCode = lineContent.charCodeAt(column - 2);\n      const charClass = wordSeparators.get(charCode);\n      if (charClass !== 0 /* WordCharacterClass.Regular */ || distance > 50) {\n        return lineContent.substring(column - 1, position.column - 1);\n      }\n      distance++;\n      column--;\n    }\n    return lineContent.substring(0, position.column - 1);\n  }\n  _getCharacterBeforePosition(position) {\n    if (position.column > 1) {\n      const lineContent = this._context.viewModel.getLineContent(position.lineNumber);\n      const charBefore = lineContent.charAt(position.column - 2);\n      if (!strings.isHighSurrogate(charBefore.charCodeAt(0))) {\n        return charBefore;\n      }\n    }\n    return '';\n  }\n  _getAriaLabel(options) {\n    const accessibilitySupport = options.get(2 /* EditorOption.accessibilitySupport */);\n    if (accessibilitySupport === 1 /* AccessibilitySupport.Disabled */) {\n      return nls.localize('accessibilityOffAriaLabel', \"The editor is not accessible at this time. Press {0} for options.\", platform.isLinux ? 'Shift+Alt+F1' : 'Alt+F1');\n    }\n    return options.get(4 /* EditorOption.ariaLabel */);\n  }\n\n  _setAccessibilityOptions(options) {\n    this._accessibilitySupport = options.get(2 /* EditorOption.accessibilitySupport */);\n    const accessibilityPageSize = options.get(3 /* EditorOption.accessibilityPageSize */);\n    if (this._accessibilitySupport === 2 /* AccessibilitySupport.Enabled */ && accessibilityPageSize === EditorOptions.accessibilityPageSize.defaultValue) {\n      // If a screen reader is attached and the default value is not set we should automatically increase the page size to 500 for a better experience\n      this._accessibilityPageSize = 500;\n    } else {\n      this._accessibilityPageSize = accessibilityPageSize;\n    }\n  }\n  // --- begin event handlers\n  onConfigurationChanged(e) {\n    const options = this._context.configuration.options;\n    const layoutInfo = options.get(133 /* EditorOption.layoutInfo */);\n    this._setAccessibilityOptions(options);\n    this._contentLeft = layoutInfo.contentLeft;\n    this._contentWidth = layoutInfo.contentWidth;\n    this._contentHeight = layoutInfo.height;\n    this._fontInfo = options.get(46 /* EditorOption.fontInfo */);\n    this._lineHeight = options.get(61 /* EditorOption.lineHeight */);\n    this._emptySelectionClipboard = options.get(33 /* EditorOption.emptySelectionClipboard */);\n    this._copyWithSyntaxHighlighting = options.get(21 /* EditorOption.copyWithSyntaxHighlighting */);\n    this.textArea.setAttribute('aria-label', this._getAriaLabel(options));\n    this.textArea.setAttribute('tabindex', String(options.get(114 /* EditorOption.tabIndex */)));\n    if (e.hasChanged(30 /* EditorOption.domReadOnly */) || e.hasChanged(83 /* EditorOption.readOnly */)) {\n      if (options.get(30 /* EditorOption.domReadOnly */) && options.get(83 /* EditorOption.readOnly */)) {\n        this.textArea.setAttribute('readonly', 'true');\n      } else {\n        this.textArea.removeAttribute('readonly');\n      }\n    }\n    if (e.hasChanged(2 /* EditorOption.accessibilitySupport */)) {\n      this._textAreaInput.writeScreenReaderContent('strategy changed');\n    }\n    return true;\n  }\n  onCursorStateChanged(e) {\n    this._selections = e.selections.slice(0);\n    this._modelSelections = e.modelSelections.slice(0);\n    this._textAreaInput.writeScreenReaderContent('selection changed');\n    return true;\n  }\n  onDecorationsChanged(e) {\n    // true for inline decorations that can end up relayouting text\n    return true;\n  }\n  onFlushed(e) {\n    return true;\n  }\n  onLinesChanged(e) {\n    return true;\n  }\n  onLinesDeleted(e) {\n    return true;\n  }\n  onLinesInserted(e) {\n    return true;\n  }\n  onScrollChanged(e) {\n    this._scrollLeft = e.scrollLeft;\n    this._scrollTop = e.scrollTop;\n    return true;\n  }\n  onZonesChanged(e) {\n    return true;\n  }\n  // --- end event handlers\n  // --- begin view API\n  isFocused() {\n    return this._textAreaInput.isFocused();\n  }\n  focusTextArea() {\n    this._textAreaInput.focusTextArea();\n  }\n  getLastRenderData() {\n    return this._lastRenderPosition;\n  }\n  setAriaOptions(options) {\n    if (options.activeDescendant) {\n      this.textArea.setAttribute('aria-haspopup', 'true');\n      this.textArea.setAttribute('aria-autocomplete', 'list');\n      this.textArea.setAttribute('aria-activedescendant', options.activeDescendant);\n    } else {\n      this.textArea.setAttribute('aria-haspopup', 'false');\n      this.textArea.setAttribute('aria-autocomplete', 'both');\n      this.textArea.removeAttribute('aria-activedescendant');\n    }\n    if (options.role) {\n      this.textArea.setAttribute('role', options.role);\n    }\n  }\n  prepareRender(ctx) {\n    var _a;\n    this._primaryCursorPosition = new Position(this._selections[0].positionLineNumber, this._selections[0].positionColumn);\n    this._primaryCursorVisibleRange = ctx.visibleRangeForPosition(this._primaryCursorPosition);\n    (_a = this._visibleTextArea) === null || _a === void 0 ? void 0 : _a.prepareRender(ctx);\n  }\n  render(ctx) {\n    this._textAreaInput.writeScreenReaderContent('render');\n    this._render();\n  }\n  _render() {\n    if (this._visibleTextArea) {\n      // The text area is visible for composition reasons\n      const visibleStart = this._visibleTextArea.visibleTextareaStart;\n      const visibleEnd = this._visibleTextArea.visibleTextareaEnd;\n      const startPosition = this._visibleTextArea.startPosition;\n      const endPosition = this._visibleTextArea.endPosition;\n      if (startPosition && endPosition && visibleStart && visibleEnd && visibleEnd.left >= this._scrollLeft && visibleStart.left <= this._scrollLeft + this._contentWidth) {\n        const top = this._context.viewLayout.getVerticalOffsetForLineNumber(this._primaryCursorPosition.lineNumber) - this._scrollTop;\n        const lineCount = this._newlinecount(this.textArea.domNode.value.substr(0, this.textArea.domNode.selectionStart));\n        let scrollLeft = this._visibleTextArea.widthOfHiddenLineTextBefore;\n        let left = this._contentLeft + visibleStart.left - this._scrollLeft;\n        // See https://github.com/microsoft/vscode/issues/141725#issuecomment-1050670841\n        // Here we are adding +1 to avoid flickering that might be caused by having a width that is too small.\n        // This could be caused by rounding errors that might only show up with certain font families.\n        // In other words, a pixel might be lost when doing something like\n        //      `Math.round(end) - Math.round(start)`\n        // vs\n        //      `Math.round(end - start)`\n        let width = visibleEnd.left - visibleStart.left + 1;\n        if (left < this._contentLeft) {\n          // the textarea would be rendered on top of the margin,\n          // so reduce its width. We use the same technique as\n          // for hiding text before\n          const delta = this._contentLeft - left;\n          left += delta;\n          scrollLeft += delta;\n          width -= delta;\n        }\n        if (width > this._contentWidth) {\n          // the textarea would be wider than the content width,\n          // so reduce its width.\n          width = this._contentWidth;\n        }\n        // Try to render the textarea with the color/font style to match the text under it\n        const viewLineData = this._context.viewModel.getViewLineData(startPosition.lineNumber);\n        const startTokenIndex = viewLineData.tokens.findTokenIndexAtOffset(startPosition.column - 1);\n        const endTokenIndex = viewLineData.tokens.findTokenIndexAtOffset(endPosition.column - 1);\n        const textareaSpansSingleToken = startTokenIndex === endTokenIndex;\n        const presentation = this._visibleTextArea.definePresentation(textareaSpansSingleToken ? viewLineData.tokens.getPresentation(startTokenIndex) : null);\n        this.textArea.domNode.scrollTop = lineCount * this._lineHeight;\n        this.textArea.domNode.scrollLeft = scrollLeft;\n        this._doRender({\n          lastRenderPosition: null,\n          top: top,\n          left: left,\n          width: width,\n          height: this._lineHeight,\n          useCover: false,\n          color: (TokenizationRegistry.getColorMap() || [])[presentation.foreground],\n          italic: presentation.italic,\n          bold: presentation.bold,\n          underline: presentation.underline,\n          strikethrough: presentation.strikethrough\n        });\n      }\n      return;\n    }\n    if (!this._primaryCursorVisibleRange) {\n      // The primary cursor is outside the viewport => place textarea to the top left\n      this._renderAtTopLeft();\n      return;\n    }\n    const left = this._contentLeft + this._primaryCursorVisibleRange.left - this._scrollLeft;\n    if (left < this._contentLeft || left > this._contentLeft + this._contentWidth) {\n      // cursor is outside the viewport\n      this._renderAtTopLeft();\n      return;\n    }\n    const top = this._context.viewLayout.getVerticalOffsetForLineNumber(this._selections[0].positionLineNumber) - this._scrollTop;\n    if (top < 0 || top > this._contentHeight) {\n      // cursor is outside the viewport\n      this._renderAtTopLeft();\n      return;\n    }\n    // The primary cursor is in the viewport (at least vertically) => place textarea on the cursor\n    if (platform.isMacintosh) {\n      // For the popup emoji input, we will make the text area as high as the line height\n      // We will also make the fontSize and lineHeight the correct dimensions to help with the placement of these pickers\n      this._doRender({\n        lastRenderPosition: this._primaryCursorPosition,\n        top: top,\n        left: left,\n        width: canUseZeroSizeTextarea ? 0 : 1,\n        height: this._lineHeight,\n        useCover: false\n      });\n      // In case the textarea contains a word, we're going to try to align the textarea's cursor\n      // with our cursor by scrolling the textarea as much as possible\n      this.textArea.domNode.scrollLeft = this._primaryCursorVisibleRange.left;\n      const lineCount = this._newlinecount(this.textArea.domNode.value.substr(0, this.textArea.domNode.selectionStart));\n      this.textArea.domNode.scrollTop = lineCount * this._lineHeight;\n      return;\n    }\n    this._doRender({\n      lastRenderPosition: this._primaryCursorPosition,\n      top: top,\n      left: left,\n      width: canUseZeroSizeTextarea ? 0 : 1,\n      height: canUseZeroSizeTextarea ? 0 : 1,\n      useCover: false\n    });\n  }\n  _newlinecount(text) {\n    let result = 0;\n    let startIndex = -1;\n    do {\n      startIndex = text.indexOf('\\n', startIndex + 1);\n      if (startIndex === -1) {\n        break;\n      }\n      result++;\n    } while (true);\n    return result;\n  }\n  _renderAtTopLeft() {\n    // (in WebKit the textarea is 1px by 1px because it cannot handle input to a 0x0 textarea)\n    // specifically, when doing Korean IME, setting the textarea to 0x0 breaks IME badly.\n    this._doRender({\n      lastRenderPosition: null,\n      top: 0,\n      left: 0,\n      width: canUseZeroSizeTextarea ? 0 : 1,\n      height: canUseZeroSizeTextarea ? 0 : 1,\n      useCover: true\n    });\n  }\n  _doRender(renderData) {\n    this._lastRenderPosition = renderData.lastRenderPosition;\n    const ta = this.textArea;\n    const tac = this.textAreaCover;\n    applyFontInfo(ta, this._fontInfo);\n    ta.setTop(renderData.top);\n    ta.setLeft(renderData.left);\n    ta.setWidth(renderData.width);\n    ta.setHeight(renderData.height);\n    ta.setColor(renderData.color ? Color.Format.CSS.formatHex(renderData.color) : '');\n    ta.setFontStyle(renderData.italic ? 'italic' : '');\n    if (renderData.bold) {\n      // fontWeight is also set by `applyFontInfo`, so only overwrite it if necessary\n      ta.setFontWeight('bold');\n    }\n    ta.setTextDecoration(`${renderData.underline ? ' underline' : ''}${renderData.strikethrough ? ' line-through' : ''}`);\n    tac.setTop(renderData.useCover ? renderData.top : 0);\n    tac.setLeft(renderData.useCover ? renderData.left : 0);\n    tac.setWidth(renderData.useCover ? renderData.width : 0);\n    tac.setHeight(renderData.useCover ? renderData.height : 0);\n    const options = this._context.configuration.options;\n    if (options.get(52 /* EditorOption.glyphMargin */)) {\n      tac.setClassName('monaco-editor-background textAreaCover ' + Margin.OUTER_CLASS_NAME);\n    } else {\n      if (options.get(62 /* EditorOption.lineNumbers */).renderType !== 0 /* RenderLineNumbersType.Off */) {\n        tac.setClassName('monaco-editor-background textAreaCover ' + LineNumbersOverlay.CLASS_NAME);\n      } else {\n        tac.setClassName('monaco-editor-background textAreaCover');\n      }\n    }\n  }\n}\nfunction measureText(text, fontInfo) {\n  if (text.length === 0) {\n    return 0;\n  }\n  const container = document.createElement('div');\n  container.style.position = 'absolute';\n  container.style.top = '-50000px';\n  container.style.width = '50000px';\n  const regularDomNode = document.createElement('span');\n  applyFontInfo(regularDomNode, fontInfo);\n  regularDomNode.style.whiteSpace = 'pre'; // just like the textarea\n  regularDomNode.append(text);\n  container.appendChild(regularDomNode);\n  document.body.appendChild(container);\n  const res = regularDomNode.offsetWidth;\n  document.body.removeChild(container);\n  return res;\n}","map":{"version":3,"names":["nls","browser","createFastDomNode","platform","strings","applyFontInfo","CopyOptions","TextAreaInput","TextAreaWrapper","PagedScreenReaderStrategy","TextAreaState","_debugComposition","PartFingerprints","ViewPart","LineNumbersOverlay","Margin","EditorOptions","getMapForWordSeparators","Position","Range","Selection","MOUSE_CURSOR_TEXT_CSS_CLASS_NAME","TokenizationRegistry","Color","VisibleTextAreaData","constructor","_context","modelLineNumber","distanceToModelLineStart","widthOfHiddenLineTextBefore","distanceToModelLineEnd","_visibleTextAreaBrand","undefined","startPosition","endPosition","visibleTextareaStart","visibleTextareaEnd","_previousPresentation","prepareRender","visibleRangeProvider","startModelPosition","endModelPosition","viewModel","model","getLineMaxColumn","coordinatesConverter","convertModelPositionToViewPosition","lineNumber","visibleRangeForPosition","definePresentation","tokenPresentation","foreground","italic","bold","underline","strikethrough","canUseZeroSizeTextarea","isFirefox","TextAreaHandler","context","viewController","_primaryCursorPosition","_primaryCursorVisibleRange","_viewController","_visibleRangeProvider","_scrollLeft","_scrollTop","options","configuration","layoutInfo","get","_setAccessibilityOptions","_contentLeft","contentLeft","_contentWidth","contentWidth","_contentHeight","height","_fontInfo","_lineHeight","_emptySelectionClipboard","_copyWithSyntaxHighlighting","_visibleTextArea","_selections","_modelSelections","_lastRenderPosition","textArea","document","createElement","write","setClassName","setAttribute","_getAriaLabel","String","localize","textAreaCover","setPosition","simpleModel","getLineCount","getValueInRange","range","eol","textAreaInputHost","getDataToCopy","rawTextToCopy","getPlainTextToCopy","isWindows","newLineCharacter","getEOL","isFromEmptySelection","length","isEmpty","multicursorText","Array","isArray","text","join","html","mode","forceCopyWithSyntaxHighlighting","richText","getRichTextToCopy","getScreenReaderContent","currentState","_accessibilitySupport","selection","isMacintosh","position","getStartPosition","textBefore","_getWordBeforePosition","_getCharacterBeforePosition","isSafari","placeholderText","EMPTY","isAndroid","wordAtPosition","positionOffsetInWord","_getAndroidWordAtPosition","fromEditorSelection","_accessibilityPageSize","deduceModelPosition","viewAnchorPosition","deltaOffset","lineFeedCnt","deduceModelPositionRelativeToViewPosition","textAreaWrapper","_register","domNode","_textAreaInput","OS","onKeyDown","e","emitKeyDown","onKeyUp","emitKeyUp","onPaste","pasteOnNewLine","metadata","paste","onCut","cut","onType","replacePrevCharCnt","replaceNextCharCnt","positionDelta","console","log","compositionType","type","onSelectionChangeRequest","modelSelection","setSelection","onCompositionStart","ta","widthOfHiddenTextBefore","textBeforeSelection","value","substring","Math","min","selectionStart","selectionEnd","lineFeedOffset1","lastIndexOf","lineTextBeforeSelection","tabOffset1","desiredVisibleBeforeCharCount","visibleBeforeCharCount","column","hiddenLineTextBefore","measureText","textAfterSelection","max","lineFeedOffset2","indexOf","lineTextAfterSelection","tabOffset2","desiredVisibleAfterCharCount","getEndPosition","visibleAfterCharCount","revealRange","fromPositions","startLineNumber","_render","compositionStart","onCompositionUpdate","onCompositionEnd","compositionEnd","onFocus","setHasFocus","onBlur","dispose","ANDROID_WORD_SEPARATORS","lineContent","getLineContent","wordSeparators","goingLeft","startColumn","goingRight","endColumn","distance","charCode","charCodeAt","charClass","charBefore","charAt","isHighSurrogate","accessibilitySupport","isLinux","accessibilityPageSize","defaultValue","onConfigurationChanged","hasChanged","removeAttribute","writeScreenReaderContent","onCursorStateChanged","selections","slice","modelSelections","onDecorationsChanged","onFlushed","onLinesChanged","onLinesDeleted","onLinesInserted","onScrollChanged","scrollLeft","scrollTop","onZonesChanged","isFocused","focusTextArea","getLastRenderData","setAriaOptions","activeDescendant","role","ctx","_a","positionLineNumber","positionColumn","render","visibleStart","visibleEnd","left","top","viewLayout","getVerticalOffsetForLineNumber","lineCount","_newlinecount","substr","width","delta","viewLineData","getViewLineData","startTokenIndex","tokens","findTokenIndexAtOffset","endTokenIndex","textareaSpansSingleToken","presentation","getPresentation","_doRender","lastRenderPosition","useCover","color","getColorMap","_renderAtTopLeft","result","startIndex","renderData","tac","setTop","setLeft","setWidth","setHeight","setColor","Format","CSS","formatHex","setFontStyle","setFontWeight","setTextDecoration","OUTER_CLASS_NAME","renderType","CLASS_NAME","fontInfo","container","style","regularDomNode","whiteSpace","append","appendChild","body","res","offsetWidth","removeChild"],"sources":["/home/deathblade287/Desktop/AI-MODELS-TESTING/react-app/node_modules/monaco-editor/esm/vs/editor/browser/controller/textAreaHandler.js"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport './textAreaHandler.css';\nimport * as nls from '../../../nls.js';\nimport * as browser from '../../../base/browser/browser.js';\nimport { createFastDomNode } from '../../../base/browser/fastDomNode.js';\nimport * as platform from '../../../base/common/platform.js';\nimport * as strings from '../../../base/common/strings.js';\nimport { applyFontInfo } from '../config/domFontInfo.js';\nimport { CopyOptions, TextAreaInput, TextAreaWrapper } from './textAreaInput.js';\nimport { PagedScreenReaderStrategy, TextAreaState, _debugComposition } from './textAreaState.js';\nimport { PartFingerprints, ViewPart } from '../view/viewPart.js';\nimport { LineNumbersOverlay } from '../viewParts/lineNumbers/lineNumbers.js';\nimport { Margin } from '../viewParts/margin/margin.js';\nimport { EditorOptions } from '../../common/config/editorOptions.js';\nimport { getMapForWordSeparators } from '../../common/core/wordCharacterClassifier.js';\nimport { Position } from '../../common/core/position.js';\nimport { Range } from '../../common/core/range.js';\nimport { Selection } from '../../common/core/selection.js';\nimport { MOUSE_CURSOR_TEXT_CSS_CLASS_NAME } from '../../../base/browser/ui/mouseCursor/mouseCursor.js';\nimport { TokenizationRegistry } from '../../common/languages.js';\nimport { Color } from '../../../base/common/color.js';\nclass VisibleTextAreaData {\n    constructor(_context, modelLineNumber, distanceToModelLineStart, widthOfHiddenLineTextBefore, distanceToModelLineEnd) {\n        this._context = _context;\n        this.modelLineNumber = modelLineNumber;\n        this.distanceToModelLineStart = distanceToModelLineStart;\n        this.widthOfHiddenLineTextBefore = widthOfHiddenLineTextBefore;\n        this.distanceToModelLineEnd = distanceToModelLineEnd;\n        this._visibleTextAreaBrand = undefined;\n        this.startPosition = null;\n        this.endPosition = null;\n        this.visibleTextareaStart = null;\n        this.visibleTextareaEnd = null;\n        /**\n         * When doing composition, the currently composed text might be split up into\n         * multiple tokens, then merged again into a single token, etc. Here we attempt\n         * to keep the presentation of the <textarea> stable by using the previous used\n         * style if multiple tokens come into play. This avoids flickering.\n         */\n        this._previousPresentation = null;\n    }\n    prepareRender(visibleRangeProvider) {\n        const startModelPosition = new Position(this.modelLineNumber, this.distanceToModelLineStart + 1);\n        const endModelPosition = new Position(this.modelLineNumber, this._context.viewModel.model.getLineMaxColumn(this.modelLineNumber) - this.distanceToModelLineEnd);\n        this.startPosition = this._context.viewModel.coordinatesConverter.convertModelPositionToViewPosition(startModelPosition);\n        this.endPosition = this._context.viewModel.coordinatesConverter.convertModelPositionToViewPosition(endModelPosition);\n        if (this.startPosition.lineNumber === this.endPosition.lineNumber) {\n            this.visibleTextareaStart = visibleRangeProvider.visibleRangeForPosition(this.startPosition);\n            this.visibleTextareaEnd = visibleRangeProvider.visibleRangeForPosition(this.endPosition);\n        }\n        else {\n            // TODO: what if the view positions are not on the same line?\n            this.visibleTextareaStart = null;\n            this.visibleTextareaEnd = null;\n        }\n    }\n    definePresentation(tokenPresentation) {\n        if (!this._previousPresentation) {\n            // To avoid flickering, once set, always reuse a presentation throughout the entire IME session\n            if (tokenPresentation) {\n                this._previousPresentation = tokenPresentation;\n            }\n            else {\n                this._previousPresentation = {\n                    foreground: 1 /* ColorId.DefaultForeground */,\n                    italic: false,\n                    bold: false,\n                    underline: false,\n                    strikethrough: false,\n                };\n            }\n        }\n        return this._previousPresentation;\n    }\n}\nconst canUseZeroSizeTextarea = (browser.isFirefox);\nexport class TextAreaHandler extends ViewPart {\n    constructor(context, viewController, visibleRangeProvider) {\n        super(context);\n        // --- end view API\n        this._primaryCursorPosition = new Position(1, 1);\n        this._primaryCursorVisibleRange = null;\n        this._viewController = viewController;\n        this._visibleRangeProvider = visibleRangeProvider;\n        this._scrollLeft = 0;\n        this._scrollTop = 0;\n        const options = this._context.configuration.options;\n        const layoutInfo = options.get(133 /* EditorOption.layoutInfo */);\n        this._setAccessibilityOptions(options);\n        this._contentLeft = layoutInfo.contentLeft;\n        this._contentWidth = layoutInfo.contentWidth;\n        this._contentHeight = layoutInfo.height;\n        this._fontInfo = options.get(46 /* EditorOption.fontInfo */);\n        this._lineHeight = options.get(61 /* EditorOption.lineHeight */);\n        this._emptySelectionClipboard = options.get(33 /* EditorOption.emptySelectionClipboard */);\n        this._copyWithSyntaxHighlighting = options.get(21 /* EditorOption.copyWithSyntaxHighlighting */);\n        this._visibleTextArea = null;\n        this._selections = [new Selection(1, 1, 1, 1)];\n        this._modelSelections = [new Selection(1, 1, 1, 1)];\n        this._lastRenderPosition = null;\n        // Text Area (The focus will always be in the textarea when the cursor is blinking)\n        this.textArea = createFastDomNode(document.createElement('textarea'));\n        PartFingerprints.write(this.textArea, 6 /* PartFingerprint.TextArea */);\n        this.textArea.setClassName(`inputarea ${MOUSE_CURSOR_TEXT_CSS_CLASS_NAME}`);\n        this.textArea.setAttribute('wrap', 'off');\n        this.textArea.setAttribute('autocorrect', 'off');\n        this.textArea.setAttribute('autocapitalize', 'off');\n        this.textArea.setAttribute('autocomplete', 'off');\n        this.textArea.setAttribute('spellcheck', 'false');\n        this.textArea.setAttribute('aria-label', this._getAriaLabel(options));\n        this.textArea.setAttribute('tabindex', String(options.get(114 /* EditorOption.tabIndex */)));\n        this.textArea.setAttribute('role', 'textbox');\n        this.textArea.setAttribute('aria-roledescription', nls.localize('editor', \"editor\"));\n        this.textArea.setAttribute('aria-multiline', 'true');\n        this.textArea.setAttribute('aria-haspopup', 'false');\n        this.textArea.setAttribute('aria-autocomplete', 'both');\n        if (options.get(30 /* EditorOption.domReadOnly */) && options.get(83 /* EditorOption.readOnly */)) {\n            this.textArea.setAttribute('readonly', 'true');\n        }\n        this.textAreaCover = createFastDomNode(document.createElement('div'));\n        this.textAreaCover.setPosition('absolute');\n        const simpleModel = {\n            getLineCount: () => {\n                return this._context.viewModel.getLineCount();\n            },\n            getLineMaxColumn: (lineNumber) => {\n                return this._context.viewModel.getLineMaxColumn(lineNumber);\n            },\n            getValueInRange: (range, eol) => {\n                return this._context.viewModel.getValueInRange(range, eol);\n            }\n        };\n        const textAreaInputHost = {\n            getDataToCopy: () => {\n                const rawTextToCopy = this._context.viewModel.getPlainTextToCopy(this._modelSelections, this._emptySelectionClipboard, platform.isWindows);\n                const newLineCharacter = this._context.viewModel.model.getEOL();\n                const isFromEmptySelection = (this._emptySelectionClipboard && this._modelSelections.length === 1 && this._modelSelections[0].isEmpty());\n                const multicursorText = (Array.isArray(rawTextToCopy) ? rawTextToCopy : null);\n                const text = (Array.isArray(rawTextToCopy) ? rawTextToCopy.join(newLineCharacter) : rawTextToCopy);\n                let html = undefined;\n                let mode = null;\n                if (CopyOptions.forceCopyWithSyntaxHighlighting || (this._copyWithSyntaxHighlighting && text.length < 65536)) {\n                    const richText = this._context.viewModel.getRichTextToCopy(this._modelSelections, this._emptySelectionClipboard);\n                    if (richText) {\n                        html = richText.html;\n                        mode = richText.mode;\n                    }\n                }\n                return {\n                    isFromEmptySelection,\n                    multicursorText,\n                    text,\n                    html,\n                    mode\n                };\n            },\n            getScreenReaderContent: (currentState) => {\n                if (this._accessibilitySupport === 1 /* AccessibilitySupport.Disabled */) {\n                    // We know for a fact that a screen reader is not attached\n                    // On OSX, we write the character before the cursor to allow for \"long-press\" composition\n                    // Also on OSX, we write the word before the cursor to allow for the Accessibility Keyboard to give good hints\n                    const selection = this._selections[0];\n                    if (platform.isMacintosh && selection.isEmpty()) {\n                        const position = selection.getStartPosition();\n                        let textBefore = this._getWordBeforePosition(position);\n                        if (textBefore.length === 0) {\n                            textBefore = this._getCharacterBeforePosition(position);\n                        }\n                        if (textBefore.length > 0) {\n                            return new TextAreaState(textBefore, textBefore.length, textBefore.length, position, position);\n                        }\n                    }\n                    // on Safari, document.execCommand('cut') and document.execCommand('copy') will just not work\n                    // if the textarea has no content selected. So if there is an editor selection, ensure something\n                    // is selected in the textarea.\n                    if (browser.isSafari && !selection.isEmpty()) {\n                        const placeholderText = 'vscode-placeholder';\n                        return new TextAreaState(placeholderText, 0, placeholderText.length, null, null);\n                    }\n                    return TextAreaState.EMPTY;\n                }\n                if (browser.isAndroid) {\n                    // when tapping in the editor on a word, Android enters composition mode.\n                    // in the `compositionstart` event we cannot clear the textarea, because\n                    // it then forgets to ever send a `compositionend`.\n                    // we therefore only write the current word in the textarea\n                    const selection = this._selections[0];\n                    if (selection.isEmpty()) {\n                        const position = selection.getStartPosition();\n                        const [wordAtPosition, positionOffsetInWord] = this._getAndroidWordAtPosition(position);\n                        if (wordAtPosition.length > 0) {\n                            return new TextAreaState(wordAtPosition, positionOffsetInWord, positionOffsetInWord, position, position);\n                        }\n                    }\n                    return TextAreaState.EMPTY;\n                }\n                return PagedScreenReaderStrategy.fromEditorSelection(currentState, simpleModel, this._selections[0], this._accessibilityPageSize, this._accessibilitySupport === 0 /* AccessibilitySupport.Unknown */);\n            },\n            deduceModelPosition: (viewAnchorPosition, deltaOffset, lineFeedCnt) => {\n                return this._context.viewModel.deduceModelPositionRelativeToViewPosition(viewAnchorPosition, deltaOffset, lineFeedCnt);\n            }\n        };\n        const textAreaWrapper = this._register(new TextAreaWrapper(this.textArea.domNode));\n        this._textAreaInput = this._register(new TextAreaInput(textAreaInputHost, textAreaWrapper, platform.OS, browser));\n        this._register(this._textAreaInput.onKeyDown((e) => {\n            this._viewController.emitKeyDown(e);\n        }));\n        this._register(this._textAreaInput.onKeyUp((e) => {\n            this._viewController.emitKeyUp(e);\n        }));\n        this._register(this._textAreaInput.onPaste((e) => {\n            let pasteOnNewLine = false;\n            let multicursorText = null;\n            let mode = null;\n            if (e.metadata) {\n                pasteOnNewLine = (this._emptySelectionClipboard && !!e.metadata.isFromEmptySelection);\n                multicursorText = (typeof e.metadata.multicursorText !== 'undefined' ? e.metadata.multicursorText : null);\n                mode = e.metadata.mode;\n            }\n            this._viewController.paste(e.text, pasteOnNewLine, multicursorText, mode);\n        }));\n        this._register(this._textAreaInput.onCut(() => {\n            this._viewController.cut();\n        }));\n        this._register(this._textAreaInput.onType((e) => {\n            if (e.replacePrevCharCnt || e.replaceNextCharCnt || e.positionDelta) {\n                // must be handled through the new command\n                if (_debugComposition) {\n                    console.log(` => compositionType: <<${e.text}>>, ${e.replacePrevCharCnt}, ${e.replaceNextCharCnt}, ${e.positionDelta}`);\n                }\n                this._viewController.compositionType(e.text, e.replacePrevCharCnt, e.replaceNextCharCnt, e.positionDelta);\n            }\n            else {\n                if (_debugComposition) {\n                    console.log(` => type: <<${e.text}>>`);\n                }\n                this._viewController.type(e.text);\n            }\n        }));\n        this._register(this._textAreaInput.onSelectionChangeRequest((modelSelection) => {\n            this._viewController.setSelection(modelSelection);\n        }));\n        this._register(this._textAreaInput.onCompositionStart((e) => {\n            // The textarea might contain some content when composition starts.\n            //\n            // When we make the textarea visible, it always has a height of 1 line,\n            // so we don't need to worry too much about content on lines above or below\n            // the selection.\n            //\n            // However, the text on the current line needs to be made visible because\n            // some IME methods allow to move to other glyphs on the current line\n            // (by pressing arrow keys).\n            //\n            // (1) The textarea might contain only some parts of the current line,\n            // like the word before the selection. Also, the content inside the textarea\n            // can grow or shrink as composition occurs. We therefore anchor the textarea\n            // in terms of distance to a certain line start and line end.\n            //\n            // (2) Also, we should not make \\t characters visible, because their rendering\n            // inside the <textarea> will not align nicely with our rendering. We therefore\n            // will hide (if necessary) some of the leading text on the current line.\n            const ta = this.textArea.domNode;\n            const modelSelection = this._modelSelections[0];\n            const { distanceToModelLineStart, widthOfHiddenTextBefore } = (() => {\n                // Find the text that is on the current line before the selection\n                const textBeforeSelection = ta.value.substring(0, Math.min(ta.selectionStart, ta.selectionEnd));\n                const lineFeedOffset1 = textBeforeSelection.lastIndexOf('\\n');\n                const lineTextBeforeSelection = textBeforeSelection.substring(lineFeedOffset1 + 1);\n                // We now search to see if we should hide some part of it (if it contains \\t)\n                const tabOffset1 = lineTextBeforeSelection.lastIndexOf('\\t');\n                const desiredVisibleBeforeCharCount = lineTextBeforeSelection.length - tabOffset1 - 1;\n                const startModelPosition = modelSelection.getStartPosition();\n                const visibleBeforeCharCount = Math.min(startModelPosition.column - 1, desiredVisibleBeforeCharCount);\n                const distanceToModelLineStart = startModelPosition.column - 1 - visibleBeforeCharCount;\n                const hiddenLineTextBefore = lineTextBeforeSelection.substring(0, lineTextBeforeSelection.length - visibleBeforeCharCount);\n                const widthOfHiddenTextBefore = measureText(hiddenLineTextBefore, this._fontInfo);\n                return { distanceToModelLineStart, widthOfHiddenTextBefore };\n            })();\n            const { distanceToModelLineEnd } = (() => {\n                // Find the text that is on the current line after the selection\n                const textAfterSelection = ta.value.substring(Math.max(ta.selectionStart, ta.selectionEnd));\n                const lineFeedOffset2 = textAfterSelection.indexOf('\\n');\n                const lineTextAfterSelection = lineFeedOffset2 === -1 ? textAfterSelection : textAfterSelection.substring(0, lineFeedOffset2);\n                const tabOffset2 = lineTextAfterSelection.indexOf('\\t');\n                const desiredVisibleAfterCharCount = (tabOffset2 === -1 ? lineTextAfterSelection.length : lineTextAfterSelection.length - tabOffset2 - 1);\n                const endModelPosition = modelSelection.getEndPosition();\n                const visibleAfterCharCount = Math.min(this._context.viewModel.model.getLineMaxColumn(endModelPosition.lineNumber) - endModelPosition.column, desiredVisibleAfterCharCount);\n                const distanceToModelLineEnd = this._context.viewModel.model.getLineMaxColumn(endModelPosition.lineNumber) - endModelPosition.column - visibleAfterCharCount;\n                return { distanceToModelLineEnd };\n            })();\n            // Scroll to reveal the location in the editor where composition occurs\n            this._context.viewModel.revealRange('keyboard', true, Range.fromPositions(this._selections[0].getStartPosition()), 0 /* viewEvents.VerticalRevealType.Simple */, 1 /* ScrollType.Immediate */);\n            this._visibleTextArea = new VisibleTextAreaData(this._context, modelSelection.startLineNumber, distanceToModelLineStart, widthOfHiddenTextBefore, distanceToModelLineEnd);\n            this._visibleTextArea.prepareRender(this._visibleRangeProvider);\n            this._render();\n            // Show the textarea\n            this.textArea.setClassName(`inputarea ${MOUSE_CURSOR_TEXT_CSS_CLASS_NAME} ime-input`);\n            this._viewController.compositionStart();\n            this._context.viewModel.onCompositionStart();\n        }));\n        this._register(this._textAreaInput.onCompositionUpdate((e) => {\n            if (!this._visibleTextArea) {\n                return;\n            }\n            this._visibleTextArea.prepareRender(this._visibleRangeProvider);\n            this._render();\n        }));\n        this._register(this._textAreaInput.onCompositionEnd(() => {\n            this._visibleTextArea = null;\n            this._render();\n            this.textArea.setClassName(`inputarea ${MOUSE_CURSOR_TEXT_CSS_CLASS_NAME}`);\n            this._viewController.compositionEnd();\n            this._context.viewModel.onCompositionEnd();\n        }));\n        this._register(this._textAreaInput.onFocus(() => {\n            this._context.viewModel.setHasFocus(true);\n        }));\n        this._register(this._textAreaInput.onBlur(() => {\n            this._context.viewModel.setHasFocus(false);\n        }));\n    }\n    dispose() {\n        super.dispose();\n    }\n    _getAndroidWordAtPosition(position) {\n        const ANDROID_WORD_SEPARATORS = '`~!@#$%^&*()-=+[{]}\\\\|;:\",.<>/?';\n        const lineContent = this._context.viewModel.getLineContent(position.lineNumber);\n        const wordSeparators = getMapForWordSeparators(ANDROID_WORD_SEPARATORS);\n        let goingLeft = true;\n        let startColumn = position.column;\n        let goingRight = true;\n        let endColumn = position.column;\n        let distance = 0;\n        while (distance < 50 && (goingLeft || goingRight)) {\n            if (goingLeft && startColumn <= 1) {\n                goingLeft = false;\n            }\n            if (goingLeft) {\n                const charCode = lineContent.charCodeAt(startColumn - 2);\n                const charClass = wordSeparators.get(charCode);\n                if (charClass !== 0 /* WordCharacterClass.Regular */) {\n                    goingLeft = false;\n                }\n                else {\n                    startColumn--;\n                }\n            }\n            if (goingRight && endColumn > lineContent.length) {\n                goingRight = false;\n            }\n            if (goingRight) {\n                const charCode = lineContent.charCodeAt(endColumn - 1);\n                const charClass = wordSeparators.get(charCode);\n                if (charClass !== 0 /* WordCharacterClass.Regular */) {\n                    goingRight = false;\n                }\n                else {\n                    endColumn++;\n                }\n            }\n            distance++;\n        }\n        return [lineContent.substring(startColumn - 1, endColumn - 1), position.column - startColumn];\n    }\n    _getWordBeforePosition(position) {\n        const lineContent = this._context.viewModel.getLineContent(position.lineNumber);\n        const wordSeparators = getMapForWordSeparators(this._context.configuration.options.get(119 /* EditorOption.wordSeparators */));\n        let column = position.column;\n        let distance = 0;\n        while (column > 1) {\n            const charCode = lineContent.charCodeAt(column - 2);\n            const charClass = wordSeparators.get(charCode);\n            if (charClass !== 0 /* WordCharacterClass.Regular */ || distance > 50) {\n                return lineContent.substring(column - 1, position.column - 1);\n            }\n            distance++;\n            column--;\n        }\n        return lineContent.substring(0, position.column - 1);\n    }\n    _getCharacterBeforePosition(position) {\n        if (position.column > 1) {\n            const lineContent = this._context.viewModel.getLineContent(position.lineNumber);\n            const charBefore = lineContent.charAt(position.column - 2);\n            if (!strings.isHighSurrogate(charBefore.charCodeAt(0))) {\n                return charBefore;\n            }\n        }\n        return '';\n    }\n    _getAriaLabel(options) {\n        const accessibilitySupport = options.get(2 /* EditorOption.accessibilitySupport */);\n        if (accessibilitySupport === 1 /* AccessibilitySupport.Disabled */) {\n            return nls.localize('accessibilityOffAriaLabel', \"The editor is not accessible at this time. Press {0} for options.\", platform.isLinux ? 'Shift+Alt+F1' : 'Alt+F1');\n        }\n        return options.get(4 /* EditorOption.ariaLabel */);\n    }\n    _setAccessibilityOptions(options) {\n        this._accessibilitySupport = options.get(2 /* EditorOption.accessibilitySupport */);\n        const accessibilityPageSize = options.get(3 /* EditorOption.accessibilityPageSize */);\n        if (this._accessibilitySupport === 2 /* AccessibilitySupport.Enabled */ && accessibilityPageSize === EditorOptions.accessibilityPageSize.defaultValue) {\n            // If a screen reader is attached and the default value is not set we should automatically increase the page size to 500 for a better experience\n            this._accessibilityPageSize = 500;\n        }\n        else {\n            this._accessibilityPageSize = accessibilityPageSize;\n        }\n    }\n    // --- begin event handlers\n    onConfigurationChanged(e) {\n        const options = this._context.configuration.options;\n        const layoutInfo = options.get(133 /* EditorOption.layoutInfo */);\n        this._setAccessibilityOptions(options);\n        this._contentLeft = layoutInfo.contentLeft;\n        this._contentWidth = layoutInfo.contentWidth;\n        this._contentHeight = layoutInfo.height;\n        this._fontInfo = options.get(46 /* EditorOption.fontInfo */);\n        this._lineHeight = options.get(61 /* EditorOption.lineHeight */);\n        this._emptySelectionClipboard = options.get(33 /* EditorOption.emptySelectionClipboard */);\n        this._copyWithSyntaxHighlighting = options.get(21 /* EditorOption.copyWithSyntaxHighlighting */);\n        this.textArea.setAttribute('aria-label', this._getAriaLabel(options));\n        this.textArea.setAttribute('tabindex', String(options.get(114 /* EditorOption.tabIndex */)));\n        if (e.hasChanged(30 /* EditorOption.domReadOnly */) || e.hasChanged(83 /* EditorOption.readOnly */)) {\n            if (options.get(30 /* EditorOption.domReadOnly */) && options.get(83 /* EditorOption.readOnly */)) {\n                this.textArea.setAttribute('readonly', 'true');\n            }\n            else {\n                this.textArea.removeAttribute('readonly');\n            }\n        }\n        if (e.hasChanged(2 /* EditorOption.accessibilitySupport */)) {\n            this._textAreaInput.writeScreenReaderContent('strategy changed');\n        }\n        return true;\n    }\n    onCursorStateChanged(e) {\n        this._selections = e.selections.slice(0);\n        this._modelSelections = e.modelSelections.slice(0);\n        this._textAreaInput.writeScreenReaderContent('selection changed');\n        return true;\n    }\n    onDecorationsChanged(e) {\n        // true for inline decorations that can end up relayouting text\n        return true;\n    }\n    onFlushed(e) {\n        return true;\n    }\n    onLinesChanged(e) {\n        return true;\n    }\n    onLinesDeleted(e) {\n        return true;\n    }\n    onLinesInserted(e) {\n        return true;\n    }\n    onScrollChanged(e) {\n        this._scrollLeft = e.scrollLeft;\n        this._scrollTop = e.scrollTop;\n        return true;\n    }\n    onZonesChanged(e) {\n        return true;\n    }\n    // --- end event handlers\n    // --- begin view API\n    isFocused() {\n        return this._textAreaInput.isFocused();\n    }\n    focusTextArea() {\n        this._textAreaInput.focusTextArea();\n    }\n    getLastRenderData() {\n        return this._lastRenderPosition;\n    }\n    setAriaOptions(options) {\n        if (options.activeDescendant) {\n            this.textArea.setAttribute('aria-haspopup', 'true');\n            this.textArea.setAttribute('aria-autocomplete', 'list');\n            this.textArea.setAttribute('aria-activedescendant', options.activeDescendant);\n        }\n        else {\n            this.textArea.setAttribute('aria-haspopup', 'false');\n            this.textArea.setAttribute('aria-autocomplete', 'both');\n            this.textArea.removeAttribute('aria-activedescendant');\n        }\n        if (options.role) {\n            this.textArea.setAttribute('role', options.role);\n        }\n    }\n    prepareRender(ctx) {\n        var _a;\n        this._primaryCursorPosition = new Position(this._selections[0].positionLineNumber, this._selections[0].positionColumn);\n        this._primaryCursorVisibleRange = ctx.visibleRangeForPosition(this._primaryCursorPosition);\n        (_a = this._visibleTextArea) === null || _a === void 0 ? void 0 : _a.prepareRender(ctx);\n    }\n    render(ctx) {\n        this._textAreaInput.writeScreenReaderContent('render');\n        this._render();\n    }\n    _render() {\n        if (this._visibleTextArea) {\n            // The text area is visible for composition reasons\n            const visibleStart = this._visibleTextArea.visibleTextareaStart;\n            const visibleEnd = this._visibleTextArea.visibleTextareaEnd;\n            const startPosition = this._visibleTextArea.startPosition;\n            const endPosition = this._visibleTextArea.endPosition;\n            if (startPosition && endPosition && visibleStart && visibleEnd && visibleEnd.left >= this._scrollLeft && visibleStart.left <= this._scrollLeft + this._contentWidth) {\n                const top = (this._context.viewLayout.getVerticalOffsetForLineNumber(this._primaryCursorPosition.lineNumber) - this._scrollTop);\n                const lineCount = this._newlinecount(this.textArea.domNode.value.substr(0, this.textArea.domNode.selectionStart));\n                let scrollLeft = this._visibleTextArea.widthOfHiddenLineTextBefore;\n                let left = (this._contentLeft + visibleStart.left - this._scrollLeft);\n                // See https://github.com/microsoft/vscode/issues/141725#issuecomment-1050670841\n                // Here we are adding +1 to avoid flickering that might be caused by having a width that is too small.\n                // This could be caused by rounding errors that might only show up with certain font families.\n                // In other words, a pixel might be lost when doing something like\n                //      `Math.round(end) - Math.round(start)`\n                // vs\n                //      `Math.round(end - start)`\n                let width = visibleEnd.left - visibleStart.left + 1;\n                if (left < this._contentLeft) {\n                    // the textarea would be rendered on top of the margin,\n                    // so reduce its width. We use the same technique as\n                    // for hiding text before\n                    const delta = (this._contentLeft - left);\n                    left += delta;\n                    scrollLeft += delta;\n                    width -= delta;\n                }\n                if (width > this._contentWidth) {\n                    // the textarea would be wider than the content width,\n                    // so reduce its width.\n                    width = this._contentWidth;\n                }\n                // Try to render the textarea with the color/font style to match the text under it\n                const viewLineData = this._context.viewModel.getViewLineData(startPosition.lineNumber);\n                const startTokenIndex = viewLineData.tokens.findTokenIndexAtOffset(startPosition.column - 1);\n                const endTokenIndex = viewLineData.tokens.findTokenIndexAtOffset(endPosition.column - 1);\n                const textareaSpansSingleToken = (startTokenIndex === endTokenIndex);\n                const presentation = this._visibleTextArea.definePresentation((textareaSpansSingleToken ? viewLineData.tokens.getPresentation(startTokenIndex) : null));\n                this.textArea.domNode.scrollTop = lineCount * this._lineHeight;\n                this.textArea.domNode.scrollLeft = scrollLeft;\n                this._doRender({\n                    lastRenderPosition: null,\n                    top: top,\n                    left: left,\n                    width: width,\n                    height: this._lineHeight,\n                    useCover: false,\n                    color: (TokenizationRegistry.getColorMap() || [])[presentation.foreground],\n                    italic: presentation.italic,\n                    bold: presentation.bold,\n                    underline: presentation.underline,\n                    strikethrough: presentation.strikethrough\n                });\n            }\n            return;\n        }\n        if (!this._primaryCursorVisibleRange) {\n            // The primary cursor is outside the viewport => place textarea to the top left\n            this._renderAtTopLeft();\n            return;\n        }\n        const left = this._contentLeft + this._primaryCursorVisibleRange.left - this._scrollLeft;\n        if (left < this._contentLeft || left > this._contentLeft + this._contentWidth) {\n            // cursor is outside the viewport\n            this._renderAtTopLeft();\n            return;\n        }\n        const top = this._context.viewLayout.getVerticalOffsetForLineNumber(this._selections[0].positionLineNumber) - this._scrollTop;\n        if (top < 0 || top > this._contentHeight) {\n            // cursor is outside the viewport\n            this._renderAtTopLeft();\n            return;\n        }\n        // The primary cursor is in the viewport (at least vertically) => place textarea on the cursor\n        if (platform.isMacintosh) {\n            // For the popup emoji input, we will make the text area as high as the line height\n            // We will also make the fontSize and lineHeight the correct dimensions to help with the placement of these pickers\n            this._doRender({\n                lastRenderPosition: this._primaryCursorPosition,\n                top: top,\n                left: left,\n                width: (canUseZeroSizeTextarea ? 0 : 1),\n                height: this._lineHeight,\n                useCover: false\n            });\n            // In case the textarea contains a word, we're going to try to align the textarea's cursor\n            // with our cursor by scrolling the textarea as much as possible\n            this.textArea.domNode.scrollLeft = this._primaryCursorVisibleRange.left;\n            const lineCount = this._newlinecount(this.textArea.domNode.value.substr(0, this.textArea.domNode.selectionStart));\n            this.textArea.domNode.scrollTop = lineCount * this._lineHeight;\n            return;\n        }\n        this._doRender({\n            lastRenderPosition: this._primaryCursorPosition,\n            top: top,\n            left: left,\n            width: (canUseZeroSizeTextarea ? 0 : 1),\n            height: (canUseZeroSizeTextarea ? 0 : 1),\n            useCover: false\n        });\n    }\n    _newlinecount(text) {\n        let result = 0;\n        let startIndex = -1;\n        do {\n            startIndex = text.indexOf('\\n', startIndex + 1);\n            if (startIndex === -1) {\n                break;\n            }\n            result++;\n        } while (true);\n        return result;\n    }\n    _renderAtTopLeft() {\n        // (in WebKit the textarea is 1px by 1px because it cannot handle input to a 0x0 textarea)\n        // specifically, when doing Korean IME, setting the textarea to 0x0 breaks IME badly.\n        this._doRender({\n            lastRenderPosition: null,\n            top: 0,\n            left: 0,\n            width: (canUseZeroSizeTextarea ? 0 : 1),\n            height: (canUseZeroSizeTextarea ? 0 : 1),\n            useCover: true\n        });\n    }\n    _doRender(renderData) {\n        this._lastRenderPosition = renderData.lastRenderPosition;\n        const ta = this.textArea;\n        const tac = this.textAreaCover;\n        applyFontInfo(ta, this._fontInfo);\n        ta.setTop(renderData.top);\n        ta.setLeft(renderData.left);\n        ta.setWidth(renderData.width);\n        ta.setHeight(renderData.height);\n        ta.setColor(renderData.color ? Color.Format.CSS.formatHex(renderData.color) : '');\n        ta.setFontStyle(renderData.italic ? 'italic' : '');\n        if (renderData.bold) {\n            // fontWeight is also set by `applyFontInfo`, so only overwrite it if necessary\n            ta.setFontWeight('bold');\n        }\n        ta.setTextDecoration(`${renderData.underline ? ' underline' : ''}${renderData.strikethrough ? ' line-through' : ''}`);\n        tac.setTop(renderData.useCover ? renderData.top : 0);\n        tac.setLeft(renderData.useCover ? renderData.left : 0);\n        tac.setWidth(renderData.useCover ? renderData.width : 0);\n        tac.setHeight(renderData.useCover ? renderData.height : 0);\n        const options = this._context.configuration.options;\n        if (options.get(52 /* EditorOption.glyphMargin */)) {\n            tac.setClassName('monaco-editor-background textAreaCover ' + Margin.OUTER_CLASS_NAME);\n        }\n        else {\n            if (options.get(62 /* EditorOption.lineNumbers */).renderType !== 0 /* RenderLineNumbersType.Off */) {\n                tac.setClassName('monaco-editor-background textAreaCover ' + LineNumbersOverlay.CLASS_NAME);\n            }\n            else {\n                tac.setClassName('monaco-editor-background textAreaCover');\n            }\n        }\n    }\n}\nfunction measureText(text, fontInfo) {\n    if (text.length === 0) {\n        return 0;\n    }\n    const container = document.createElement('div');\n    container.style.position = 'absolute';\n    container.style.top = '-50000px';\n    container.style.width = '50000px';\n    const regularDomNode = document.createElement('span');\n    applyFontInfo(regularDomNode, fontInfo);\n    regularDomNode.style.whiteSpace = 'pre'; // just like the textarea\n    regularDomNode.append(text);\n    container.appendChild(regularDomNode);\n    document.body.appendChild(container);\n    const res = regularDomNode.offsetWidth;\n    document.body.removeChild(container);\n    return res;\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}